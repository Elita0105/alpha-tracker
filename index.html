<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ AlphaÁ©çÂàÜËøΩËπ§Âô®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK v9 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, getDocs, getDoc, query, orderBy, onSnapshot, setDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        // üî• Firebase ÈÖçÁΩÆ - Ë´ãÊõøÊèõÁÇ∫ÊÇ®ÁöÑÈÖçÁΩÆ
        const firebaseConfig = {
            apiKey: "AIzaSyDMofD3aNCKr93VuX6yCBINpaTlm-4S3kE",
            authDomain: "alpha-tracker-e0a04.firebaseapp.com",
            projectId: "alpha-tracker-e0a04",
            storageBucket: "alpha-tracker-e0a04.firebasestorage.app",
            messagingSenderId: "373250511486",
            appId: "1:373250511486:web:eb22c6c69289b677c3be2f"
        };

        // ÂàùÂßãÂåñ Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Â∞á Firebase ÂØ¶‰æãÊö¥Èú≤Âà∞ÂÖ®Â±Ä
        window.db = db;
        window.firebaseModules = {
            collection, addDoc, updateDoc, deleteDoc, doc, getDocs, getDoc, query, orderBy, onSnapshot, setDoc
        };
        
        console.log('üî• Firebase Â∑≤ÂàùÂßãÂåñ');
    </script>
    
    <!-- Chart.js ÂúñË°®Â∫´ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        :root {
            --cyber-dark: #0F172A;
            --cyber-gray: #1E293B;
            --cyber-light: #334155;
            --neon-yellow: #FBBF24;
            --neon-green: #10B981;
            --neon-red: #EF4444;
            --neon-blue: #3B82F6;
        }
        
        body {
            background: linear-gradient(135deg, var(--cyber-dark) 0%, var(--cyber-gray) 50%, var(--cyber-light) 100%);
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(251, 191, 36, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }
        
        .input-glow:focus {
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1), 0 0 15px rgba(251, 191, 36, 0.2);
            border-color: var(--neon-yellow);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--neon-yellow), #F59E0B);
            color: #1F2937;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(45deg, #F59E0B, #D97706);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(251, 191, 36, 0.4);
        }
        
        .btn-green {
            background: linear-gradient(45deg, var(--neon-green), #059669);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-green:hover {
            background: linear-gradient(45deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }
        
        .btn-red {
            background: linear-gradient(45deg, var(--neon-red), #DC2626);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-red:hover {
            background: linear-gradient(45deg, #DC2626, #B91C1C);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
        }
        
        .btn-blue {
            background: linear-gradient(45deg, var(--neon-blue), #2563EB);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-blue:hover {
            background: linear-gradient(45deg, #2563EB, #1D4ED8);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }
        
        .btn-gray {
            background: linear-gradient(45deg, #6B7280, #4B5563);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-gray:hover {
            background: linear-gradient(45deg, #4B5563, #374151);
            transform: translateY(-1px);
        }
        
        .tab-active {
            background: linear-gradient(45deg, var(--neon-yellow), #F59E0B);
            color: #1F2937;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
        }
        
        .tab-inactive {
            color: #9CA3AF;
            transition: all 0.3s ease;
        }
        
        .tab-inactive:hover {
            color: white;
            background: rgba(75, 85, 99, 0.3);
        }
        
        .record-card {
            background: rgba(51, 65, 85, 0.5);
            border: 1px solid rgba(75, 85, 99, 0.3);
            transition: all 0.3s ease;
        }
        
        .record-card:hover {
            background: rgba(51, 65, 85, 0.8);
            border-color: rgba(251, 191, 36, 0.3);
            transform: translateY(-1px);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--neon-yellow), #F59E0B, var(--neon-yellow));
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .text-neon-yellow { color: var(--neon-yellow); }
        .text-neon-green { color: var(--neon-green); }
        .text-neon-red { color: var(--neon-red); }
        .text-neon-blue { color: var(--neon-blue); }
        
        .bg-cyber-dark { background-color: var(--cyber-dark); }
        .bg-cyber-gray { background-color: var(--cyber-gray); }
        .bg-cyber-light { background-color: var(--cyber-light); }
        
        .border-neon-yellow { border-color: var(--neon-yellow); }
        .border-neon-green { border-color: var(--neon-green); }
        .border-neon-red { border-color: var(--neon-red); }
        
        .stat-card-yellow {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.05));
            border: 1px solid rgba(251, 191, 36, 0.2);
        }
        
        .stat-card-green {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .stat-card-red {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .info-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .sync-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .sync-online {
            background: rgba(16, 185, 129, 0.2);
            color: var(--neon-green);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .sync-offline {
            background: rgba(239, 68, 68, 0.2);
            color: var(--neon-red);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .sync-syncing {
            background: rgba(251, 191, 36, 0.2);
            color: var(--neon-yellow);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        
        .pagination-btn {
            background: rgba(75, 85, 99, 0.3);
            border: 1px solid rgba(75, 85, 99, 0.5);
            color: #9CA3AF;
            transition: all 0.3s ease;
        }
        
        .pagination-btn:hover {
            background: rgba(251, 191, 36, 0.2);
            border-color: rgba(251, 191, 36, 0.5);
            color: var(--neon-yellow);
        }
        
        .pagination-btn.active {
            background: linear-gradient(45deg, var(--neon-yellow), #F59E0B);
            color: #1F2937;
            border-color: var(--neon-yellow);
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="text-white">
    <div class="max-w-6xl mx-auto p-6">
        
        <!-- Header -->
        <div class="text-center mb-12 relative z-10">
            <h1 class="text-6xl font-bold mb-4 tracking-tight relative">
                <span class="inline-block mr-4 text-6xl">üöÄ</span>
                <span style="background: linear-gradient(45deg, var(--neon-yellow), #F97316); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">AlphaÁ©çÂàÜËøΩËπ§Âô®</span>
            </h1>
            
            <!-- Èõ≤Á´ØÂêåÊ≠•ÁãÄÊÖã -->
            <div class="mb-6">
                <div id="syncStatus" class="sync-indicator sync-offline mx-auto">
                    <span id="syncIcon">‚ö†Ô∏è</span>
                    <span id="syncText">Á≠âÂæÖFirebaseÈÄ£Á∑ö</span>
                </div>
            </div>
            
            <!-- ÁõÆÊ®ôË®≠ÂÆö -->
            <div class="glass-card rounded-2xl p-6 inline-block">
                <div class="flex items-center justify-center gap-4">
                    <span class="text-gray-300 text-lg">üéØ ÁõÆÊ®ôÁ©çÂàÜ:</span>
                    <input
                        type="number"
                        id="targetPoints"
                        value="150"
                        class="bg-cyber-gray text-neon-yellow px-4 py-2 rounded-xl border border-gray-600 input-glow focus:outline-none text-xl font-bold text-center w-24"
                    />
                    <span class="text-gray-300 text-lg">ÂàÜ</span>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="glass-card stat-card-yellow rounded-2xl p-6 neon-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">15Â§©Ê∑®Á©çÂàÜ</p>
                        <p class="text-4xl font-bold text-neon-yellow mb-1" id="netPoints">0</p>
                        <p class="text-gray-500 text-xs" id="dateRange">ÁØÑÂúç: --</p>
                        <p class="text-gray-500 text-xs" id="remainingPoints">ÈÇÑÈúÄ 0 ÂàÜ</p>
                    </div>
                    <div class="text-5xl">üéØ</div>
                </div>
            </div>
            
            <div class="glass-card stat-card-green rounded-2xl p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">Á©∫ÊäïÊ¨°Êï∏</p>
                        <p class="text-4xl font-bold text-neon-green mb-1" id="airdropCount">0</p>
                        <p class="text-gray-500 text-xs" id="airdropDeduction">Êâ£ 0 ÂàÜ</p>
                    </div>
                    <div class="text-5xl">üéÅ</div>
                </div>
            </div>

            <div class="glass-card stat-card-red rounded-2xl p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">Á∏ΩÊàêÊú¨</p>
                        <p class="text-4xl font-bold text-neon-red mb-1" id="totalCost">0</p>
                        <p class="text-gray-500 text-xs">USDT</p>
                    </div>
                    <div class="text-5xl">üí∏</div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="glass-card rounded-2xl p-8 mb-12">
            <div class="flex justify-between items-center mb-4">
                <span class="text-gray-300 text-lg">üöÄ ÁõÆÊ®ôÈÄ≤Â∫¶</span>
                <span class="text-neon-yellow font-bold text-xl" id="progressText">0/150 ÂàÜ</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                <div id="progressBar" class="progress-bar h-4 rounded-full transition-all duration-1000" style="width: 0%"></div>
            </div>
            <p class="text-gray-400 text-sm mt-3" id="progressStatus">ÈÇÑÈúÄË¶Å 150 ÂàÜÈÅîÂà∞ÁõÆÊ®ô</p>
        </div>

        <!-- Tab Navigation -->
        <div class="flex bg-cyber-gray rounded-2xl p-2 mb-8 gap-2">
            <button onclick="switchTab('daily')" id="tab-daily" class="tab-btn flex-1 flex items-center justify-center gap-3 py-4 px-6 rounded-xl transition-all text-lg font-semibold tab-active">
                üìÖ ÊØèÊó•Âà∑ÂàÜ
            </button>
            <button onclick="switchTab('cost')" id="tab-cost" class="tab-btn flex-1 flex items-center justify-center gap-3 py-4 px-6 rounded-xl transition-all text-lg font-semibold tab-inactive">
                üí∏ ÊàêÊú¨ËøΩËπ§
            </button>
            <button onclick="switchTab('airdrop')" id="tab-airdrop" class="tab-btn flex-1 flex items-center justify-center gap-3 py-4 px-6 rounded-xl transition-all text-lg font-semibold tab-inactive">
                üéÅ Á©∫ÊäïË®òÈåÑ
            </button>
            <button onclick="switchTab('charts')" id="tab-charts" class="tab-btn flex-1 flex items-center justify-center gap-3 py-4 px-6 rounded-xl transition-all text-lg font-semibold tab-inactive">
                üìä Ë∂®Âã¢ÂàÜÊûê
            </button>
            <button onclick="switchTab('analysis')" id="tab-analysis" class="tab-btn flex-1 flex items-center justify-center gap-3 py-4 px-6 rounded-xl transition-all text-lg font-semibold tab-inactive">
                üìà Êï∏ÊìöÂ∞éÂá∫
            </button>
        </div>

        <!-- Content Areas -->
        <div class="glass-card rounded-2xl p-8">
            <!-- Daily Points Tab -->
            <div id="daily-content" class="tab-content">
                <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    üìÖ ÊØèÊó•Âà∑ÂàÜË®òÈåÑ
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <input type="date" id="dailyDate" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none transition-all">
                    <input type="number" id="dailyPoints" placeholder="Áï∂Êó•Âà∑ÂàÜ" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none transition-all">
                    <button onclick="addDailyRecord()" class="btn-primary px-6 py-3 rounded-xl text-lg">
                        ‚ûï Ê∑ªÂä†Ë®òÈåÑ
                    </button>
                </div>

                <div id="dailyRecords" class="space-y-3">
                    <div class="text-center text-gray-500 py-8 text-lg">üìù Â∞öÁÑ°Âà∑ÂàÜË®òÈåÑ</div>
                </div>
                
                <!-- ÂàÜÈ†ÅÊéßÂà∂ -->
                <div id="dailyPagination" class="hidden flex justify-center items-center gap-2 mt-6">
                    <button onclick="changeDailyPage(-1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">‚¨ÖÔ∏è ‰∏ä‰∏ÄÈ†Å</button>
                    <span id="dailyPageInfo" class="text-gray-400 px-4">Á¨¨ 1 È†ÅÔºåÂÖ± 1 È†Å</span>
                    <button onclick="changeDailyPage(1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">‰∏ã‰∏ÄÈ†Å ‚û°Ô∏è</button>
                </div>
            </div>

            <!-- Cost Tab -->
            <div id="cost-content" class="tab-content hidden">
                <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    üí∏ ÊàêÊú¨ËøΩËπ§ 
                    <span id="loadingIndicator" class="text-neon-yellow text-sm px-3 py-1 rounded-full hidden animate-pulse" style="background: rgba(251, 191, 36, 0.2);">Ê≠£Âú®Áç≤ÂèñÂåØÁéá...</span>
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <input type="date" id="costDate" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-red transition-all">
                    <input type="number" id="costBnb" step="0.00000001" placeholder="Gas Fee (BNB)" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-red transition-all">
                    <input type="number" id="costSlippage" step="0.00000001" placeholder="Á£®Êêç (USDT)" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-red transition-all">
                    <button onclick="addCost()" class="btn-red px-6 py-3 rounded-xl">
                        ‚ûï Ê∑ªÂä†ÊàêÊú¨
                    </button>
                </div>

                <div id="costRecords" class="space-y-3">
                    <div class="text-center text-gray-500 py-8 text-lg">üí∏ Â∞öÁÑ°ÊàêÊú¨Ë®òÈåÑ</div>
                </div>
                
                <!-- ÂàÜÈ†ÅÊéßÂà∂ -->
                <div id="costPagination" class="hidden flex justify-center items-center gap-2 mt-6">
                    <button onclick="changeCostPage(-1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">‚¨ÖÔ∏è ‰∏ä‰∏ÄÈ†Å</button>
                    <span id="costPageInfo" class="text-gray-400 px-4">Á¨¨ 1 È†ÅÔºåÂÖ± 1 È†Å</span>
                    <button onclick="changeCostPage(1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">‰∏ã‰∏ÄÈ†Å ‚û°Ô∏è</button>
                </div>
            </div>

            <!-- Airdrop Tab -->
            <div id="airdrop-content" class="tab-content hidden">
                <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    üéÅ Á©∫ÊäïË®òÈåÑ <span class="text-sm text-gray-400 bg-cyber-gray px-3 py-1 rounded-full">ÊØèÊ¨°Êâ£15ÂàÜ</span>
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <input type="date" id="airdropDate" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-green transition-all">
                    <input type="text" id="airdropToken" placeholder="‰ª£Âπ£ÂêçÁ®±" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-green transition-all">
                    <input type="number" id="airdropAmount" step="0.00000001" placeholder="Êï∏Èáè" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-green transition-all">
                    <div class="flex gap-2">
                        <input type="number" id="airdropValue" step="0.00000001" placeholder="USDTÊî∂Áõä" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-green transition-all flex-1">
                        <button onclick="addAirdrop()" class="btn-green px-6 py-3 rounded-xl">
                            ‚ûï
                        </button>
                    </div>
                </div>

                <div id="airdropRecords" class="space-y-3">
                    <div class="text-center text-gray-500 py-8 text-lg">üéÅ Â∞öÁÑ°Á©∫ÊäïË®òÈåÑ</div>
                </div>
                
                <!-- ÂàÜÈ†ÅÊéßÂà∂ -->
                <div id="airdropPagination" class="hidden flex justify-center items-center gap-2 mt-6">
                    <button onclick="changeAirdropPage(-1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">‚¨ÖÔ∏è ‰∏ä‰∏ÄÈ†Å</button>
                    <span id="airdropPageInfo" class="text-gray-400 px-4">Á¨¨ 1 È†ÅÔºåÂÖ± 1 È†Å</span>
                    <button onclick="changeAirdropPage(1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">‰∏ã‰∏ÄÈ†Å ‚û°Ô∏è</button>
                </div>
            </div>

            <!-- Charts Tab -->
            <div id="charts-content" class="tab-content hidden">
                <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    üìä Ë∂®Âã¢ÂàÜÊûêËàáË¶ñË¶∫Âåñ
                </h3>
                
                <!-- Âø´ÈÄüÁµ±Ë®àÊ¶ÇË¶Ω -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="info-box p-4 rounded-xl text-center">
                        <p class="text-gray-400 text-sm">Êú¨ÊúàÂà∑ÂàÜ</p>
                        <p class="text-neon-yellow text-2xl font-bold" id="monthlyPoints">0</p>
                    </div>
                    <div class="info-box p-4 rounded-xl text-center">
                        <p class="text-gray-400 text-sm">Êú¨ÊúàÁ©∫Êäï</p>
                        <p class="text-neon-green text-2xl font-bold" id="monthlyAirdrops">0</p>
                    </div>
                    <div class="info-box p-4 rounded-xl text-center">
                        <p class="text-gray-400 text-sm">Êú¨ÊúàÊàêÊú¨</p>
                        <p class="text-neon-red text-2xl font-bold" id="monthlyCosts">0</p>
                    </div>
                    <div class="info-box p-4 rounded-xl text-center">
                        <p class="text-gray-400 text-sm">Êú¨ÊúàROI</p>
                        <p class="text-neon-blue text-2xl font-bold" id="monthlyROI">0%</p>
                    </div>
                </div>
                
                <!-- ÂúñË°®ÂçÄÂüü -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- ÊúàÂ∫¶Êî∂ÁõäÂ∞çÊØî -->
                    <div class="glass-card p-6 rounded-xl">
                        <h4 class="text-lg font-bold mb-4 flex items-center gap-2">
                            üí∞ ÊúàÂ∫¶Êî∂ÁõäÂ∞çÊØî (Á©∫Êäï vs ÊàêÊú¨)
                        </h4>
                        <div class="relative h-64">
                            <canvas id="monthlyRevenueChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- BNBÂåØÁéáË∂®Âã¢ -->
                    <div class="glass-card p-6 rounded-xl">
                        <h4 class="text-lg font-bold mb-4 flex items-center gap-2">
                            üìà BNB‰∏≠ÂçàÂåØÁéáË∂®Âã¢ (Ëøë30Â§©)
                        </h4>
                        <div class="relative h-64">
                            <canvas id="bnbRateChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- ÊØèÊó•Âà∑ÂàÜË∂®Âã¢ -->
                    <div class="glass-card p-6 rounded-xl">
                        <h4 class="text-lg font-bold mb-4 flex items-center gap-2">
                            üìÖ ÊØèÊó•Âà∑ÂàÜË∂®Âã¢ (Ëøë30Â§©)
                        </h4>
                        <div class="relative h-64">
                            <canvas id="dailyPointsChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- ÊàêÊú¨/Á£®ÊêçÂàÜÊûê -->
                    <div class="glass-card p-6 rounded-xl">
                        <h4 class="text-lg font-bold mb-4 flex items-center gap-2">
                            üí∏ ÊàêÊú¨ÁµÑÊàêÂàÜÊûê (Ëøë30Â§©)
                        </h4>
                        <div class="relative h-64">
                            <canvas id="costAnalysisChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Êô∫ËÉΩÂª∫Ë≠∞ -->
                <div class="glass-card p-8 rounded-xl">
                    <h4 class="text-xl font-bold mb-6 flex items-center gap-3">
                        üìã Êô∫ËÉΩÂàÜÊûêÂ†±Ë°®
                    </h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- ÊúàÂ∫¶Â†±Âëä -->
                        <div class="info-box p-6 rounded-xl">
                            <h5 class="font-bold text-neon-blue mb-4">üìÖ Êú¨ÊúàÁ∏ΩÁµê</h5>
                            <div id="monthlyReport" class="space-y-2 text-sm">
                                <p>ËºâÂÖ•‰∏≠...</p>
                            </div>
                        </div>
                        
                        <!-- Â≠£Â∫¶ÂàÜÊûê -->
                        <div class="info-box p-6 rounded-xl">
                            <h5 class="font-bold text-neon-green mb-4">üìä Â≠£Â∫¶ÂàÜÊûê</h5>
                            <div id="quarterlyReport" class="space-y-2 text-sm">
                                <p>ËºâÂÖ•‰∏≠...</p>
                            </div>
                        </div>
                        
                        <!-- Êô∫ËÉΩÂª∫Ë≠∞ -->
                        <div class="info-box p-6 rounded-xl">
                            <h5 class="font-bold text-neon-yellow mb-4">üí° Êï∏ÊìöÂª∫Ë≠∞</h5>
                            <div id="smartSuggestions" class="space-y-2 text-sm">
                                <p>ËºâÂÖ•‰∏≠...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Tab -->
            <div id="analysis-content" class="tab-content hidden">
                <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    üìà Êï∏ÊìöÂàÜÊûêËàáÂ∞éÂá∫
                </h3>
                
                <!-- Êï∏ÊìöÂ∞éÂá∫ÂçÄÂüü -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="info-box p-6 rounded-xl text-center">
                        <div class="text-4xl mb-3">üìä</div>
                        <h4 class="text-neon-blue font-bold mb-3">ÂÆåÊï¥Êï∏Êìö</h4>
                        <p class="text-sm text-blue-100 mb-4">Â∞éÂá∫ÊâÄÊúâÊ≠∑Âè≤Ë®òÈåÑÔºåÈÅ©ÂêàÊ∑±Â∫¶ÂàÜÊûê</p>
                        <button onclick="exportAllData()" class="btn-blue px-6 py-2 rounded-lg w-full">
                            ‰∏ãËºâ CSV
                        </button>
                    </div>
                    
                    <div class="info-box p-6 rounded-xl text-center">
                        <div class="text-4xl mb-3">üìÖ</div>
                        <h4 class="text-neon-blue font-bold mb-3">Áï∂ÊúàÊï∏Êìö</h4>
                        <p class="text-sm text-blue-100 mb-4">Â∞éÂá∫Êú¨ÊúàË®òÈåÑÔºåÈÅ©ÂêàÊúàÂ∫¶ÂõûÈ°ß</p>
                        <button onclick="exportMonthData()" class="btn-blue px-6 py-2 rounded-lg w-full">
                            ‰∏ãËºâ CSV
                        </button>
                    </div>
                    
                    <div class="info-box p-6 rounded-xl text-center">
                        <div class="text-4xl mb-3">üìà</div>
                        <h4 class="text-neon-blue font-bold mb-3">Ëøë3ÂÄãÊúà</h4>
                        <p class="text-sm text-blue-100 mb-4">Â∞éÂá∫Â≠£Â∫¶Êï∏ÊìöÔºåÈÅ©ÂêàË∂®Âã¢ÂàÜÊûê</p>
                        <button onclick="exportQuarterData()" class="btn-blue px-6 py-2 rounded-lg w-full">
                            ‰∏ãËºâ CSV
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Stats -->
        <div class="glass-card rounded-2xl p-8 mt-12">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold flex items-center gap-3">üìä 15Â§©Ë©≥Á¥∞Áµ±Ë®à</h3>
                <div class="flex gap-2">
                    <button onclick="clearAllData()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                        üóëÔ∏è Ê∏ÖÈô§ÊâÄÊúâÊï∏Êìö
                    </button>
                </div>
            </div>
            <p class="text-gray-400 text-sm mb-8 bg-cyber-gray px-4 py-2 rounded-lg" id="statsDateRange">Áµ±Ë®àÁØÑÂúç: -- (Ââç15Â§©Ôºå‰∏çÂê´‰ªäÊó•)</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Âà∑ÂàÜÁ∏ΩË®à:</span>
                        <span class="text-neon-yellow font-bold text-lg" id="statsGrossPoints">0 ÂàÜ</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Á©∫ÊäïÊâ£ÂàÜ:</span>
                        <span class="text-neon-red font-bold text-lg" id="statsAirdropDeducted">-0 ÂàÜ</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Ê∑®Á©çÂàÜ:</span>
                        <span class="text-neon-green font-bold text-lg" id="statsNetPoints">0 ÂàÜ</span>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Á©∫ÊäïÊî∂Áõä:</span>
                        <span class="text-neon-green font-bold text-lg" id="statsAirdropRevenue">0 USDT</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Á∏ΩÊàêÊú¨:</span>
                        <span class="text-neon-red font-bold text-lg" id="statsTotalCost">0 USDT</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Ê∑®Êî∂Áõä:</span>
                        <span class="text-neon-blue font-bold text-lg" id="statsNetRevenue">0 USDT</span>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">ÁõÆÊ®ôË®≠ÂÆö:</span>
                        <span class="text-neon-yellow font-bold text-lg" id="statsTarget">150 ÂàÜ</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Ë∑ùÈõ¢ÁõÆÊ®ô:</span>
                        <span class="text-neon-blue font-bold text-lg" id="statsRemaining">150 ÂàÜ</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">Á©∫ÊäïÁ∏ΩÊï∏:</span>
                        <span class="text-neon-green font-bold text-lg" id="statsAirdropTotal">0 Ê¨°</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // üî• Firebase Èõ≤Á´ØÂêåÊ≠•ÁâàÊú¨ - ÊúÄÂ∞èÂåñ‰øÆÊ≠£Áâà
        
        // Êï∏ÊìöÂ≠òÂÑ≤
        let dailyRecords = [];
        let airdrops = [];
        let costs = [];
        let targetPoints = 150;
        let bnbRateCache = {};
        let lastSelectedRateInfo = null;

        // ÂàÜÈ†ÅÁãÄÊÖã
        let dailyCurrentPage = 1;
        let airdropCurrentPage = 1;
        let costCurrentPage = 1;
        const itemsPerPage = 10;

        // Firebase ÈÄ£Á∑öÁãÄÊÖã
        let isFirebaseReady = false;
        let syncStatus = 'offline';

        // ÂúñË°®ÂØ¶‰æã
        let monthlyRevenueChart = null;
        let bnbRateChart = null;
        let dailyPointsChart = null;
        let costAnalysisChart = null;

        // üî• ‰øÆÊ≠£Áâà Firebase Êï∏ÊìöÂêåÊ≠•ÂáΩÊï∏ - ÁúüÊ≠£ÁöÑÂêåÊ≠•ÁâàÊú¨
        async function saveToFirebase() {
            if (!isFirebaseReady) {
                console.log('Firebase Â∞öÊú™Ê∫ñÂÇôÂ•ΩÔºåÊö´Â≠òÂà∞Êú¨Âú∞');
                return false;
            }

            try {
                updateSyncStatus('syncing');
                const { setDoc, doc } = window.firebaseModules;
                
                // Á∞°ÂñÆÁöÑÊï∏ÊìöÁµêÊßãÔºå‰∏ÄÊ¨°ÊÄß‰øùÂ≠òÊâÄÊúâÊï∏Êìö
                const userData = {
                    dailyRecords,
                    airdrops,
                    costs,
                    settings: {
                        targetPoints,
                        bnbRateCache,
                        lastSelectedRateInfo
                    },
                    lastUpdated: new Date().toISOString(),
                    timestamp: Date.now()
                };

                // ‰øùÂ≠òÂà∞Âõ∫ÂÆöÊñáÊ™î ID
                await setDoc(doc(window.db, 'users', 'defaultUser'), userData);
                
                console.log('‚úÖ Ë≥áÊñôÂ∑≤ÊàêÂäüÂêåÊ≠•Âà∞ Firebase', userData);
                updateSyncStatus('online');
                return true;
            } catch (error) {
                console.error('‚ùå Firebase ÂêåÊ≠•Â§±Êïó:', error);
                updateSyncStatus('offline');
                return false;
            }
        }

        async function loadFromFirebase() {
            if (!isFirebaseReady) {
                console.log('Firebase Â∞öÊú™Ê∫ñÂÇôÂ•ΩÔºåÂæûÊú¨Âú∞Âä†Ëºâ');
                return false;
            }

            try {
                updateSyncStatus('syncing');
                const { doc, getDoc } = window.firebaseModules;
                
                // ÂæûÂõ∫ÂÆöÊñáÊ™îËÆÄÂèñÊï∏Êìö
                const docRef = doc(window.db, 'users', 'defaultUser');
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const userData = docSnap.data();
                    console.log('üî• Âæû Firebase ËÆÄÂèñÂà∞Êï∏Êìö:', userData);
                    
                    // ÊÅ¢Âæ©Êï∏Êìö
                    dailyRecords = userData.dailyRecords || [];
                    airdrops = userData.airdrops || [];
                    costs = userData.costs || [];
                    
                    if (userData.settings) {
                        targetPoints = userData.settings.targetPoints || 150;
                        bnbRateCache = userData.settings.bnbRateCache || {};
                        lastSelectedRateInfo = userData.settings.lastSelectedRateInfo || null;
                    }
                    
                    console.log(`‚úÖ Firebase Êï∏ÊìöËºâÂÖ•ÊàêÂäü: ${dailyRecords.length}Á≠ÜÂà∑ÂàÜ, ${airdrops.length}Á≠ÜÁ©∫Êäï, ${costs.length}Á≠ÜÊàêÊú¨`);
                    updateSyncStatus('online');
                    return true;
                } else {
                    console.log('üî• Firebase ‰∏≠Ê≤íÊúâÊï∏ÊìöÔºå‰ΩøÁî®Êú¨Âú∞Êï∏Êìö');
                    updateSyncStatus('online');
                    return true;
                }
            } catch (error) {
                console.error('‚ùå Firebase ËºâÂÖ•Â§±Êïó:', error);
                updateSyncStatus('offline');
                return false;
            }
        }

        // Êú¨Âú∞ÂÑ≤Â≠òÂÇô‰ªΩÂáΩÊï∏ - ‰øùÊåÅÂéüÊ®£
        function saveToLocalStorage() {
            try {
                localStorage.setItem('alpha-dailyRecords', JSON.stringify(dailyRecords));
                localStorage.setItem('alpha-airdrops', JSON.stringify(airdrops));
                localStorage.setItem('alpha-costs', JSON.stringify(costs));
                localStorage.setItem('alpha-settings', JSON.stringify({ 
                    targetPoints, 
                    bnbRateCache, 
                    lastSelectedRateInfo 
                }));
                console.log('üì± Êï∏ÊìöÂ∑≤‰øùÂ≠òÂà∞Êú¨Âú∞ÂÑ≤Â≠ò');
            } catch (error) {
                console.error('Êú¨Âú∞ÂÑ≤Â≠òÂ§±Êïó:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const loadedDaily = localStorage.getItem('alpha-dailyRecords');
                const loadedAirdrops = localStorage.getItem('alpha-airdrops');
                const loadedCosts = localStorage.getItem('alpha-costs');
                const loadedSettings = localStorage.getItem('alpha-settings');
                
                dailyRecords = loadedDaily ? JSON.parse(loadedDaily) : [];
                airdrops = loadedAirdrops ? JSON.parse(loadedAirdrops) : [];
                costs = loadedCosts ? JSON.parse(loadedCosts) : [];
                
                if (loadedSettings) {
                    const settings = JSON.parse(loadedSettings);
                    targetPoints = settings.targetPoints || 150;
                    bnbRateCache = settings.bnbRateCache || {};
                    lastSelectedRateInfo = settings.lastSelectedRateInfo || null;
                }
                
                console.log(`üì¶ ÂæûÊú¨Âú∞Âä†ËºâÊï∏Êìö: ${dailyRecords.length}Á≠ÜÂà∑ÂàÜ, ${airdrops.length}Á≠ÜÁ©∫Êäï, ${costs.length}Á≠ÜÊàêÊú¨`);
            } catch (error) {
                console.error('Êú¨Âú∞Âä†ËºâÊï∏ÊìöÂ§±Êïó:', error);
            }
        }

        // ÂêåÊ≠•ÁãÄÊÖãÊõ¥Êñ∞ - ‰øùÊåÅÂéüÊ®£
        function updateSyncStatus(status) {
            syncStatus = status;
            const statusElement = document.getElementById('syncStatus');
            const iconElement = document.getElementById('syncIcon');
            const textElement = document.getElementById('syncText');
            
            switch (status) {
                case 'online':
                    statusElement.className = 'sync-indicator sync-online mx-auto';
                    iconElement.textContent = 'üî•';
                    textElement.textContent = 'Firebase Â∑≤ÈÄ£Á∑ö';
                    break;
                case 'syncing':
                    statusElement.className = 'sync-indicator sync-syncing mx-auto';
                    iconElement.textContent = 'üîÑ';
                    textElement.textContent = 'ÂêåÊ≠•‰∏≠...';
                    break;
                case 'offline':
                default:
                    statusElement.className = 'sync-indicator sync-offline mx-auto';
                    iconElement.textContent = 'üì±';
                    textElement.textContent = 'Êú¨Âú∞Ê®°Âºè';
                    break;
            }
        }

        // Áµ±‰∏ÄÁöÑ‰øùÂ≠òÊï∏ÊìöÂáΩÊï∏ - ‰øÆÊ≠£ÁâàÊú¨
        async function saveAllData() {
            // Á∏ΩÊòØ‰øùÂ≠òÂà∞Êú¨Âú∞‰ΩúÁÇ∫ÂÇô‰ªΩ
            saveToLocalStorage();
            
            // Â¶ÇÊûúFirebaseÂèØÁî®ÔºåÂòóË©¶ÂêåÊ≠•Âà∞Èõ≤Á´Ø
            if (isFirebaseReady && syncStatus === 'online') {
                await saveToFirebase();
            }
        }

        // ÂÖ∂È§òÂáΩÊï∏‰øùÊåÅ‰∏çËÆä...
        function formatCrypto(number) {
            if (number === 0) return '0';
            return parseFloat(number.toFixed(8)).toString();
        }

        function selectNoonRate(prices, targetDate) {
            console.log(`üéØ ÈñãÂßãÊô∫ËÉΩÈÅ∏Êìá ${targetDate} ÊúÄÊé•ËøëÂè∞ÁÅ£‰∏≠Âçà12:30ÁöÑÂåØÁéá...`);
            
            const targetNoon = new Date(targetDate + 'T04:30:00.000Z');
            const targetTimestamp = targetNoon.getTime();
            
            console.log(`üïê ÁõÆÊ®ôÊôÇÈñì: Âè∞ÁÅ£ ${targetDate} 12:30 (UTC ${targetNoon.toISOString()})`);
            console.log(`üìä ÂàÜÊûê ${prices.length} ÂÄãÂÉπÊ†ºÈªû...`);
            
            let bestMatch = null;
            let minTimeDiff = Infinity;
            
            prices.forEach((price, index) => {
                const priceTimestamp = price[0];
                const priceRate = price[1];
                const timeDiff = Math.abs(priceTimestamp - targetTimestamp);
                
                const taipeiTime = new Date(priceTimestamp);
                const taipeiHours = (taipeiTime.getUTCHours() + 8) % 24;
                const taipeiMinutes = taipeiTime.getUTCMinutes();
                const timeStr = `${taipeiHours.toString().padStart(2,'0')}:${taipeiMinutes.toString().padStart(2,'0')}`;
                const diffMinutes = Math.round(timeDiff / 60000);
                
                console.log(`‚è∞ ÂÉπÊ†ºÈªû${index + 1}: Âè∞Âåó ${timeStr} - $${priceRate.toFixed(2)} (Ëàá12:30Â∑Æ${diffMinutes}ÂàÜÈêò)`);
                
                if (timeDiff < minTimeDiff) {
                    minTimeDiff = timeDiff;
                    bestMatch = {
                        rate: priceRate,
                        timestamp: priceTimestamp,
                        timeInfo: timeStr,
                        diffMinutes: diffMinutes,
                        targetDate: targetDate,
                        totalPrices: prices.length,
                        index: index + 1
                    };
                }
            });
            
            if (bestMatch) {
                console.log(`üèÜ ÊúÄ‰Ω≥ÈÅ∏Êìá: ÂÉπÊ†ºÈªû${bestMatch.index} - Âè∞Âåó ${bestMatch.timeInfo} - $${bestMatch.rate.toFixed(2)}`);
                console.log(`‚úÖ ËàáÁõÆÊ®ôÊôÇÈñì12:30Â∑ÆË∑ù: ${bestMatch.diffMinutes}ÂàÜÈêò`);
                
                lastSelectedRateInfo = {
                    date: targetDate,
                    selectedTime: bestMatch.timeInfo,
                    selectedRate: bestMatch.rate,
                    diffMinutes: bestMatch.diffMinutes,
                    totalPrices: bestMatch.totalPrices,
                    targetTime: "12:30",
                    selectedIndex: bestMatch.index,
                    timestamp: Date.now()
                };
                
                return bestMatch;
            } else {
                const middleIndex = Math.floor(prices.length / 2);
                const fallbackPrice = prices[middleIndex];
                const fallbackTime = new Date(fallbackPrice[0]);
                const fallbackHours = (fallbackTime.getUTCHours() + 8) % 24;
                const fallbackMinutes = fallbackTime.getUTCMinutes();
                const fallbackTimeStr = `${fallbackHours.toString().padStart(2,'0')}:${fallbackMinutes.toString().padStart(2,'0')}`;
                
                console.log(`‚ö° ÈôçÁ¥öËôïÁêÜ: ‰ΩøÁî®‰∏≠ÈñìÂÉπÊ†ºÈªû${middleIndex + 1} - Âè∞Âåó ${fallbackTimeStr} - $${fallbackPrice[1].toFixed(2)}`);
                
                lastSelectedRateInfo = {
                    date: targetDate,
                    selectedTime: fallbackTimeStr,
                    selectedRate: fallbackPrice[1],
                    diffMinutes: 'N/A',
                    totalPrices: prices.length,
                    targetTime: "12:30",
                    selectedIndex: middleIndex + 1,
                    fallback: true,
                    timestamp: Date.now()
                };
                
                return {
                    rate: fallbackPrice[1],
                    timeInfo: fallbackTimeStr,
                    diffMinutes: 'N/A'
                };
            }
        }

        async function getBnbRate(date) {
            if (bnbRateCache[date]) {
                console.log(`üì¶ ‰ΩøÁî®Á∑©Â≠òÂåØÁéá ${date}: $${bnbRateCache[date]}`);
                if (lastSelectedRateInfo && lastSelectedRateInfo.date === date) {
                    return {
                        rate: bnbRateCache[date],
                        timeInfo: lastSelectedRateInfo.selectedTime,
                        diffMinutes: lastSelectedRateInfo.diffMinutes,
                        fromCache: true
                    };
                }
                return { 
                    rate: bnbRateCache[date], 
                    timeInfo: 'Á∑©Â≠òÊï∏Êìö', 
                    diffMinutes: 'Êú™Áü•',
                    fromCache: true 
                };
            }
            
            try {
                console.log(`üåê ÈñãÂßãÁç≤Âèñ ${date} ÁöÑÊô∫ËÉΩ‰∏≠ÂçàÂåØÁéá...`);
                
                const dayStart = new Date(date).setHours(0, 0, 0, 0);
                const dayEnd = new Date(date).setHours(23, 59, 59, 999);
                const fromTimestamp = Math.floor(dayStart / 1000);
                const toTimestamp = Math.floor(dayEnd / 1000);
                
                const apiUrl = `https://api.coingecko.com/api/v3/coins/binancecoin/market_chart/range?vs_currency=usd&from=${fromTimestamp}&to=${toTimestamp}`;
                console.log(`üì° APIË´ãÊ±Ç: ${apiUrl}`);
                
                const response = await fetch(apiUrl);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.prices && data.prices.length > 0) {
                        console.log(`üìä Áç≤Âæó ${data.prices.length} ÂÄãÂÉπÊ†ºÈªû`);
                        
                        const selectedRate = selectNoonRate(data.prices, date);
                        
                        bnbRateCache[date] = selectedRate.rate;
                        await saveAllData();
                        console.log(`‚úÖ Êô∫ËÉΩÈÅ∏Êìá ${date} BNBÂåØÁéá: $${selectedRate.rate.toFixed(2)} (Âè∞ÂåóÊôÇÈñì ${selectedRate.timeInfo})`);
                        
                        return {
                            rate: selectedRate.rate,
                            timeInfo: selectedRate.timeInfo,
                            diffMinutes: selectedRate.diffMinutes,
                            fromCache: false
                        };
                    }
                }
                
                console.log(`‚ö†Ô∏è ÁÑ°Ê≥ïÁç≤Âèñ ${date} ÁöÑBNBÂÉπÊ†ºÔºå‰ΩøÁî®È†êË®≠ÂÄº $650`);
                return { 
                    rate: 650, 
                    timeInfo: 'APIÁï∞Â∏∏Ôºå‰ΩøÁî®È†êË®≠ÂÄº', 
                    diffMinutes: 'N/A',
                    isDefault: true 
                };
            } catch (error) {
                console.error('‚ùå Áç≤ÂèñBNBÂÉπÊ†ºÂ§±Êïó:', error);
                return { 
                    rate: 650, 
                    timeInfo: `Á∂≤Ë∑ØÈåØË™§: ${error.message}`, 
                    diffMinutes: 'N/A',
                    isError: true 
                };
            }
        }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ AlphaÁ©çÂàÜËøΩËπ§Âô® FirebaseÊúÄÂ∞èÂåñ‰øÆÊ≠£ÁâàÂàùÂßãÂåñÈñãÂßã...');
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dailyDate').value = today;
            document.getElementById('airdropDate').value = today;
            document.getElementById('costDate').value = today;
            
            // ÂÖàÂä†ËºâÊú¨Âú∞Êï∏Êìö
            loadFromLocalStorage();
            
            // Á≠âÂæÖFirebaseÂàùÂßãÂåñ
            setTimeout(async () => {
                try {
                    if (window.db && window.firebaseModules) {
                        isFirebaseReady = true;
                        console.log('üî• Firebase ÈÄ£Á∑öÊ∏¨Ë©¶...');
                        const success = await loadFromFirebase();
                        if (success) {
                            console.log('üî• Firebase Êï∏ÊìöËºâÂÖ•ÂÆåÊàê');
                            // ÈáçÊñ∞ËºâÂÖ•ÂæåÊõ¥Êñ∞È°ØÁ§∫
                            document.getElementById('targetPoints').value = targetPoints;
                            updateDisplay();
                        }
                    } else {
                        console.log('üì± Firebase Êú™ÈÖçÁΩÆÔºå‰ΩøÁî®Êú¨Âú∞Ê®°Âºè');
                        updateSyncStatus('offline');
                    }
                } catch (error) {
                    console.error('Firebase ÂàùÂßãÂåñÂ§±Êïó:', error);
                    updateSyncStatus('offline');
                }
            }, 1000);
            
            console.log('‚úÖ AlphaÁ©çÂàÜËøΩËπ§Âô® FirebaseÊúÄÂ∞èÂåñ‰øÆÊ≠£ÁâàÂàùÂßãÂåñÂÆåÊàêÔºÅ');
        });

        // ÁõÆÊ®ôÁ©çÂàÜËÆäÊõ¥
        document.getElementById('targetPoints').addEventListener('change', async function() {
            targetPoints = parseInt(this.value) || 150;
            await saveAllData();
            updateDisplay();
        });

        // Ê®ôÁ±§ÂàáÊèõ
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            
            document.getElementById(tabName + '-content').classList.remove('hidden');
            const activeTab = document.getElementById('tab-' + tabName);
            activeTab.classList.add('tab-active');
            activeTab.classList.remove('tab-inactive');
            
            if (tabName === 'charts') {
                setTimeout(() => {
                    try {
                        updateMonthlyStats();
                        generateReport();
                        initializeCharts();
                    } catch (error) {
                        console.error('‚ùå ÂúñË°®ÂàùÂßãÂåñÂ§±Êïó:', error);
                    }
                }, 300);
            }
        }

        // Ë®àÁÆó15Â§©Áµ±Ë®à
        function calculate15DayStats() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const endDate = new Date(today - 1 * 24 * 60 * 60 * 1000);
            const startDate = new Date(today - 15 * 24 * 60 * 60 * 1000);
            
            const recentPoints = dailyRecords
                .filter(record => {
                    const recordDate = new Date(record.date);
                    recordDate.setHours(0, 0, 0, 0);
                    return recordDate >= startDate && recordDate <= endDate;
                })
                .reduce((sum, record) => sum + record.points, 0);
            
            const recentAirdrops = airdrops
                .filter(airdrop => {
                    const airdropDate = new Date(airdrop.date);
                    airdropDate.setHours(0, 0, 0, 0);
                    return airdropDate >= startDate && airdropDate <= endDate;
                })
                .length * 15;
            
            const netPoints = recentPoints - recentAirdrops;
            
            const formatDate = (date) => `${date.getMonth() + 1}/${date.getDate()}`;
            const dateRange = `${formatDate(startDate)} - ${formatDate(endDate)}`;
            
            return {
                grossPoints: recentPoints,
                airdropsDeducted: recentAirdrops,
                netPoints,
                remainingPoints: Math.max(targetPoints - netPoints, 0),
                dateRange
            };
        }

        // Ë®àÁÆóÁ∏ΩÊàêÊú¨
        function calculateTotalCosts() {
            const totalGasFee = costs.reduce((sum, cost) => sum + (cost.usdtValue || 0), 0);
            const totalSlippage = costs.reduce((sum, cost) => sum + (cost.slippage || 0), 0);
            return { gasFee: totalGasFee, slippage: totalSlippage };
        }

        // Ê∑ªÂä†ÊØèÊó•Ë®òÈåÑ
        async function addDailyRecord() {
            const date = document.getElementById('dailyDate').value;
            const points = parseInt(document.getElementById('dailyPoints').value);
            
            if (!date || !points) {
                alert('üö® Ë´ãÂ°´ÂØ´Êó•ÊúüÂíåÂà∑ÂàÜÊï∏');
                return;
            }
            
            const existingIndex = dailyRecords.findIndex(record => record.date === date);
            
            if (existingIndex !== -1) {
                const oldPoints = dailyRecords[existingIndex].points;
                dailyRecords[existingIndex].points = points;
                alert(`üìù Â∑≤Êõ¥Êñ∞ ${date} ÁöÑË®òÈåÑÔºö${oldPoints}ÂàÜ ‚Üí ${points}ÂàÜ`);
            } else {
                dailyRecords.push({
                    id: Date.now(),
                    date,
                    points
                });
                alert(`üìù Â∑≤Êñ∞Â¢û ${date} ÁöÑË®òÈåÑÔºö${points}ÂàÜ`);
            }
            
            document.getElementById('dailyPoints').value = '';
            await saveAllData();
            updateDisplay();
        }

        // Ê∑ªÂä†Á©∫ÊäïË®òÈåÑ
        async function addAirdrop() {
            const date = document.getElementById('airdropDate').value;
            const token = document.getElementById('airdropToken').value;
            const amount = parseFloat(document.getElementById('airdropAmount').value);
            const value = parseFloat(document.getElementById('airdropValue').value);
            
            if (!date || !token || !amount) {
                alert('üö® Ë´ãÂ°´ÂØ´Êó•Êúü„ÄÅ‰ª£Âπ£ÂêçÁ®±ÂíåÊï∏Èáè');
                return;
            }
            
            const existingIndex = airdrops.findIndex(airdrop => 
                airdrop.date === date && airdrop.token.toLowerCase() === token.toLowerCase()
            );
            
            if (existingIndex !== -1) {
                const oldAmount = airdrops[existingIndex].amount;
                const oldValue = airdrops[existingIndex].usdtValue;
                airdrops[existingIndex].amount = amount;
                airdrops[existingIndex].usdtValue = value || 0;
                alert(`üéÅ Â∑≤Êõ¥Êñ∞ ${date} ${token} ÁöÑË®òÈåÑÔºö\nÊï∏ÈáèÔºö${oldAmount} ‚Üí ${amount}\nUSDTÔºö${oldValue} ‚Üí ${value || 0}`);
            } else {
                airdrops.push({
                    id: Date.now(),
                    date,
                    token,
                    amount,
                    usdtValue: value || 0
                });
                alert(`üéÅ Â∑≤Êñ∞Â¢û ${date} ${token} ÁöÑË®òÈåÑÔºö${amount}ÂÄãÔºåÂÉπÂÄº ${value || 0} USDT`);
            }
            
            document.getElementById('airdropToken').value = '';
            document.getElementById('airdropAmount').value = '';
            document.getElementById('airdropValue').value = '';
            await saveAllData();
            updateDisplay();
        }

        // Ê∑ªÂä†ÊàêÊú¨Ë®òÈåÑ
        async function addCost() {
            const date = document.getElementById('costDate').value;
            const bnbAmount = parseFloat(document.getElementById('costBnb').value);
            const slippage = parseFloat(document.getElementById('costSlippage').value);
            
            if (!date || (!bnbAmount && !slippage)) {
                alert('üö® Ë´ãÂ°´ÂØ´Êó•ÊúüÂíåËá≥Â∞ë‰∏ÄÈ†ÖÊàêÊú¨');
                return;
            }
            
            let usdtValue = 0;
            let rateInfo = { rate: 0, timeInfo: '', diffMinutes: 'N/A' };
            
            if (bnbAmount) {
                if (bnbRateCache[date]) {
                    console.log(`üóëÔ∏è Ëá™ÂãïÊ∏ÖÈô§ ${date} ÁöÑÁ∑©Â≠òÂåØÁéáÔºåÈáçÊñ∞Áç≤Âèñ‰∏≠...`);
                    delete bnbRateCache[date];
                    delete lastSelectedRateInfo;
                }
                
                document.getElementById('loadingIndicator').classList.remove('hidden');
                rateInfo = await getBnbRate(date);
                usdtValue = bnbAmount * rateInfo.rate;
                document.getElementById('loadingIndicator').classList.add('hidden');
            }
            
            const existingIndex = costs.findIndex(cost => cost.date === date);
            
            if (existingIndex !== -1) {
                const oldBnb = costs[existingIndex].bnbAmount;
                const oldUsdt = costs[existingIndex].usdtValue;
                const oldSlippage = costs[existingIndex].slippage;
                const oldRate = costs[existingIndex].bnbRate;
                
                costs[existingIndex].bnbAmount = bnbAmount || 0;
                costs[existingIndex].usdtValue = usdtValue;
                costs[existingIndex].bnbRate = rateInfo.rate;
                costs[existingIndex].slippage = slippage || 0;
                
                let alertMessage = `üí∏ Â∑≤Êõ¥Êñ∞ ${date} ÁöÑË®òÈåÑÔºö\n` +
                    `BNBÔºö${oldBnb} ‚Üí ${bnbAmount || 0}\n` +
                    `ÂåØÁéáÔºö${formatCrypto(oldRate)} ‚Üí ${formatCrypto(rateInfo.rate)}\n` +
                    `USDTÔºö${formatCrypto(oldUsdt)} ‚Üí ${formatCrypto(usdtValue)}\n` +
                    `Á£®ÊêçÔºö${formatCrypto(oldSlippage)} ‚Üí ${formatCrypto(slippage || 0)} USDT`;
                
                if (bnbAmount) {
                    alertMessage += `\n\nüéØ Êô∫ËÉΩÂåØÁéáÈÅ∏ÊìáÈÅéÁ®ãÔºö\n`;
                    alertMessage += `‚Ä¢ ÁõÆÊ®ôÊôÇÈñìÔºöÂè∞ÁÅ£ 12:30\n`;
                    alertMessage += `‚Ä¢ ÂØ¶ÈöõÈÅ∏ÊìáÔºöÂè∞ÁÅ£ ${rateInfo.timeInfo}\n`;
                    
                    if (rateInfo.isDefault || rateInfo.isError) {
                        alertMessage += `‚Ä¢ ÁãÄÊÖãÔºö${rateInfo.isError ? 'Á∂≤Ë∑ØÁï∞Â∏∏' : 'APIÁÑ°Ë≥áÊñô'}Ôºå‰ΩøÁî®È†êË®≠ÂåØÁéá\n`;
                        alertMessage += `‚Ä¢ ÂÇôË®ªÔºöÂª∫Ë≠∞Á®çÂæåÈáçË©¶ÊàñÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Á∑ö`;
                    } else {
                        alertMessage += `‚Ä¢ ÊôÇÈñìÂ∑ÆË∑ùÔºö${rateInfo.diffMinutes === 'N/A' ? 'ÈôçÁ¥öËôïÁêÜ' : rateInfo.diffMinutes + 'ÂàÜÈêò'}\n`;
                        alertMessage += `‚Ä¢ ÁãÄÊÖãÔºö‚úÖ ÊàêÂäüÈÅ∏ÊìáÊúÄÊé•Ëøë‰∏≠ÂçàÁöÑÂåØÁéá`;
                    }
                }
                
                alert(alertMessage);
            } else {
                costs.push({
                    id: Date.now(),
                    date,
                    bnbAmount: bnbAmount || 0,
                    usdtValue,
                    bnbRate: rateInfo.rate,
                    slippage: slippage || 0
                });
                
                let alertMessage = `üí∏ Â∑≤Êñ∞Â¢û ${date} ÁöÑË®òÈåÑÔºö\n` +
                    `BNBÔºö${bnbAmount || 0}\n` +
                    `ÂåØÁéáÔºö${formatCrypto(rateInfo.rate)}\n` +
                    `USDTÔºö${formatCrypto(usdtValue)}\n` +
                    `Á£®ÊêçÔºö${formatCrypto(slippage || 0)} USDT`;
                
                if (bnbAmount) {
                    alertMessage += `\n\nüéØ Êô∫ËÉΩÂåØÁéáÈÅ∏ÊìáÈÅéÁ®ãÔºö\n`;
                    alertMessage += `‚Ä¢ ÁõÆÊ®ôÊôÇÈñìÔºöÂè∞ÁÅ£ 12:30\n`;
                    alertMessage += `‚Ä¢ ÂØ¶ÈöõÈÅ∏ÊìáÔºöÂè∞ÁÅ£ ${rateInfo.timeInfo}\n`;
                    
                    if (rateInfo.isDefault || rateInfo.isError) {
                        alertMessage += `‚Ä¢ ÁãÄÊÖãÔºö${rateInfo.isError ? 'Á∂≤Ë∑ØÁï∞Â∏∏' : 'APIÁÑ°Ë≥áÊñô'}Ôºå‰ΩøÁî®È†êË®≠ÂåØÁéá\n`;
                        alertMessage += `‚Ä¢ ÂÇôË®ªÔºöÂª∫Ë≠∞Á®çÂæåÈáçË©¶ÊàñÊ™¢Êü•Á∂≤Ë∑ØÈÄ£Á∑ö`;
                    } else {
                        alertMessage += `‚Ä¢ ÊôÇÈñìÂ∑ÆË∑ùÔºö${rateInfo.diffMinutes === 'N/A' ? 'ÈôçÁ¥öËôïÁêÜ' : rateInfo.diffMinutes + 'ÂàÜÈêò'}\n`;
                        alertMessage += `‚Ä¢ ÁãÄÊÖãÔºö‚úÖ ÊàêÂäüÈÅ∏ÊìáÊúÄÊé•Ëøë‰∏≠ÂçàÁöÑÂåØÁéá`;
                    }
                }
                
                alert(alertMessage);
            }
            
            document.getElementById('costBnb').value = '';
            document.getElementById('costSlippage').value = '';
            await saveAllData();
            updateDisplay();
        }

        // Ê∏ÖÈô§ÊâÄÊúâÊï∏Êìö
        async function clearAllData() {
            const confirmed = confirm(
                '‚ö†Ô∏è Á¢∫ÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÊï∏ÊìöÂóéÔºü\n\nÈÄôÂ∞áÂà™Èô§Ôºö\n‚Ä¢ ÊâÄÊúâÊØèÊó•Âà∑ÂàÜË®òÈåÑ\n‚Ä¢ ÊâÄÊúâÁ©∫ÊäïË®òÈåÑ\n‚Ä¢ ÊâÄÊúâÊàêÊú¨Ë®òÈåÑ\n‚Ä¢ BNBÂåØÁéáÁ∑©Â≠ò\n\nÊ≠§Êìç‰ΩúÁÑ°Ê≥ïÊí§Èä∑ÔºÅ'
            );
            
            if (confirmed) {
                dailyRecords = [];
                airdrops = [];
                costs = [];
                bnbRateCache = {};
                lastSelectedRateInfo = null;
                targetPoints = 150;
                
                dailyCurrentPage = 1;
                airdropCurrentPage = 1;
                costCurrentPage = 1;
                
                localStorage.clear();
                
                document.getElementById('targetPoints').value = 150;
                updateDisplay();
                
                alert('‚úÖ ÊâÄÊúâÊï∏ÊìöÂ∑≤Ê∏ÖÈô§ÔºÅ');
            }
        }

        // ÂÖ∂È§òÂáΩÊï∏‰øùÊåÅ‰∏çËÆä - ÂàÜÈ†Å„ÄÅÁµ±Ë®à„ÄÅÂ†±Ë°®„ÄÅÂ∞éÂá∫Á≠â
        function changeDailyPage(direction) {
            const totalPages = Math.ceil(dailyRecords.length / itemsPerPage);
            dailyCurrentPage += direction;
            if (dailyCurrentPage < 1) dailyCurrentPage = 1;
            if (dailyCurrentPage > totalPages) dailyCurrentPage = totalPages;
            updateDailyRecordsList();
        }

        function changeAirdropPage(direction) {
            const totalPages = Math.ceil(airdrops.length / itemsPerPage);
            airdropCurrentPage += direction;
            if (airdropCurrentPage < 1) airdropCurrentPage = 1;
            if (airdropCurrentPage > totalPages) airdropCurrentPage = totalPages;
            updateAirdropsList();
        }

        function changeCostPage(direction) {
            const totalPages = Math.ceil(costs.length / itemsPerPage);
            costCurrentPage += direction;
            if (costCurrentPage < 1) costCurrentPage = 1;
            if (costCurrentPage > totalPages) costCurrentPage = totalPages;
            updateCostsList();
        }

        function updateMonthlyStats() {
            const currentMonth = new Date().toISOString().substr(0, 7);
            
            const monthlyPoints = dailyRecords
                .filter(record => record.date.startsWith(currentMonth))
                .reduce((sum, record) => sum + record.points, 0);
            
            const monthlyAirdropValue = airdrops
                .filter(airdrop => airdrop.date.startsWith(currentMonth))
                .reduce((sum, airdrop) => sum + airdrop.usdtValue, 0);
            
            const monthlyCostValue = costs
                .filter(cost => cost.date.startsWith(currentMonth))
                .reduce((sum, cost) => sum + (cost.usdtValue || 0) + (cost.slippage || 0), 0);
            
            const monthlyROI = monthlyCostValue > 0 ? 
                ((monthlyAirdropValue - monthlyCostValue) / monthlyCostValue * 100) : 0;
            
            document.getElementById('monthlyPoints').textContent = monthlyPoints;
            document.getElementById('monthlyAirdrops').textContent = formatCrypto(monthlyAirdropValue);
            document.getElementById('monthlyCosts').textContent = formatCrypto(monthlyCostValue);
            document.getElementById('monthlyROI').textContent = monthlyROI.toFixed(1) + '%';
        }

        function generateReport() {
            generateMonthlyReport();
            generateQuarterlyReport();
            generateSmartSuggestions();
        }

        function generateMonthlyReport() {
            const currentMonth = new Date().toISOString().substr(0, 7);
            const monthlyRecords = dailyRecords.filter(record => record.date.startsWith(currentMonth));
            const monthlyAirdrops = airdrops.filter(airdrop => airdrop.date.startsWith(currentMonth));
            
            const totalPoints = monthlyRecords.reduce((sum, record) => sum + record.points, 0);
            const avgDaily = monthlyRecords.length > 0 ? (totalPoints / monthlyRecords.length).toFixed(1) : 0;
            const airdropCount = monthlyAirdrops.length;
            const airdropValue = monthlyAirdrops.reduce((sum, airdrop) => sum + airdrop.usdtValue, 0);
            
            const report = `
                <p class="text-blue-100">üìä Âà∑ÂàÜÂ§©Êï∏: ${monthlyRecords.length} Â§©</p>
                <p class="text-blue-100">üéØ Á∏ΩÁ©çÂàÜ: ${totalPoints} ÂàÜ</p>
                <p class="text-blue-100">üìà Êó•ÂùáÂà∑ÂàÜ: ${avgDaily} ÂàÜ</p>
                <p class="text-blue-100">üéÅ Á©∫ÊäïÊ¨°Êï∏: ${airdropCount} Ê¨°</p>
                <p class="text-blue-100">üí∞ Á©∫ÊäïÂÉπÂÄº: ${formatCrypto(airdropValue)} USDT</p>
            `;
            
            document.getElementById('monthlyReport').innerHTML = report;
        }

        function generateQuarterlyReport() {
            const threeMonthsAgo = new Date();
            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
            const cutoffDate = threeMonthsAgo.toISOString().split('T')[0];
            
            const quarterlyRecords = dailyRecords.filter(record => record.date >= cutoffDate);
            const quarterlyAirdrops = airdrops.filter(airdrop => airdrop.date >= cutoffDate);
            const quarterlyCosts = costs.filter(cost => cost.date >= cutoffDate);
            
            const totalPoints = quarterlyRecords.reduce((sum, record) => sum + record.points, 0);
            const totalRevenue = quarterlyAirdrops.reduce((sum, airdrop) => sum + airdrop.usdtValue, 0);
            const totalCosts = quarterlyCosts.reduce((sum, cost) => sum + (cost.usdtValue || 0) + (cost.slippage || 0), 0);
            const netProfit = totalRevenue - totalCosts;
            
            const report = `
                <p class="text-green-100">üìÖ Áµ±Ë®àÊúüÈñì: Ëøë3ÂÄãÊúà</p>
                <p class="text-green-100">üéØ Á¥ØË®àÁ©çÂàÜ: ${totalPoints} ÂàÜ</p>
                <p class="text-green-100">üí∞ Á∏ΩÊî∂Áõä: ${formatCrypto(totalRevenue)} USDT</p>
                <p class="text-green-100">üí∏ Á∏ΩÊàêÊú¨: ${formatCrypto(totalCosts)} USDT</p>
                <p class="text-green-100">üìä Ê∑®Âà©ÊΩ§: ${formatCrypto(netProfit)} USDT</p>
            `;
            
            document.getElementById('quarterlyReport').innerHTML = report;
        }

        function generateSmartSuggestions() {
            const stats = calculate15DayStats();
            const suggestions = [];
            
            if (dailyRecords.length >= 3) {
                const userAvgPoints = dailyRecords.reduce((sum, r) => sum + r.points, 0) / dailyRecords.length;
                const totalDays = dailyRecords.length;
                const airdropRate = airdrops.length / totalDays;
                const dailyAirdropPenalty = airdropRate * 15;
                const netDailyGrowth = userAvgPoints - dailyAirdropPenalty;
                
                suggestions.push(`üìä Âπ≥ÂùáÂà∑ÂàÜÔºö${userAvgPoints.toFixed(1)}ÂàÜ/Â§©`);
                suggestions.push(`üéØ 15Â§©Ê∑®Á©çÂàÜÔºö${stats.netPoints}/${targetPoints}ÂàÜ`);
                
                if (stats.remainingPoints > 0) {
                    const daysToTarget = Math.ceil(stats.remainingPoints / netDailyGrowth);
                    if (daysToTarget <= 7) {
                        suggestions.push(`‚≠ê È†êÊ∏¨Á¥Ñ${daysToTarget}Â§©ÈÅîÂà∞ÁõÆÊ®ô`);
                    } else {
                        suggestions.push(`üìà Âª∫Ë≠∞ÊèêÈ´òÊØèÊó•Âà∑ÂàÜËá≥${(userAvgPoints + 3).toFixed(0)}ÂàÜ`);
                    }
                } else {
                    suggestions.push(`üéâ Â∑≤ÈÅîÊàêÁõÆÊ®ôÔºÅË∂ÖÊ®ô${Math.abs(stats.remainingPoints)}ÂàÜ`);
                }
            } else {
                suggestions.push('üìä ÈúÄÊõ¥Â§öÊï∏Êìö‰æÜÁîüÊàêÂª∫Ë≠∞');
            }
            
            const suggestionHtml = suggestions.map(s => `<p class="text-yellow-100 mb-2">${s}</p>`).join('');
            document.getElementById('smartSuggestions').innerHTML = suggestionHtml;
        }

        // ÂàùÂßãÂåñÂúñË°®
        function initializeCharts() {
            try {
                initMonthlyRevenueChart();
                initBnbRateChart();
                initDailyPointsChart();
                initCostAnalysisChart();
            } catch (error) {
                console.error('ÂàùÂßãÂåñÂúñË°®Â§±Êïó:', error);
            }
        }

        // ÊúàÂ∫¶Êî∂ÁõäÂ∞çÊØîÂúñ
        function initMonthlyRevenueChart() {
            const ctx = document.getElementById('monthlyRevenueChart').getContext('2d');
            
            // Èä∑ÊØÄËàäÂúñË°®
            if (monthlyRevenueChart) {
                monthlyRevenueChart.destroy();
            }
            
            // Ë®àÁÆóËøë6ÂÄãÊúàÊï∏Êìö
            const months = [];
            const revenueData = [];
            const costData = [];
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                const monthStr = date.toISOString().substr(0, 7);
                const monthLabel = `${date.getMonth() + 1}Êúà`;
                
                const monthRevenue = airdrops
                    .filter(a => a.date.startsWith(monthStr))
                    .reduce((sum, a) => sum + a.usdtValue, 0);
                
                const monthCost = costs
                    .filter(c => c.date.startsWith(monthStr))
                    .reduce((sum, c) => sum + (c.usdtValue || 0) + (c.slippage || 0), 0);
                
                months.push(monthLabel);
                revenueData.push(monthRevenue);
                costData.push(monthCost);
            }
            
            monthlyRevenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Á©∫ÊäïÊî∂Áõä (USDT)',
                            data: revenueData,
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Á∏ΩÊàêÊú¨ (USDT)',
                            data: costData,
                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        },
                        x: {
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        }
                    }
                }
            });
        }

        // BNBÂåØÁéáË∂®Âã¢Âúñ
        function initBnbRateChart() {
            const ctx = document.getElementById('bnbRateChart').getContext('2d');
            
            if (bnbRateChart) {
                bnbRateChart.destroy();
            }
            
            // Êî∂ÈõÜËøë30Â§©ÊúâÂåØÁéáÊï∏ÊìöÁöÑÊó•Êúü
            const rateData = costs
                .filter(c => c.bnbRate && c.bnbRate > 0)
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(-30)
                .map(c => ({
                    date: c.date,
                    rate: c.bnbRate
                }));
            
            const dates = rateData.map(d => d.date.substr(5)); // MM-DDÊ†ºÂºè
            const rates = rateData.map(d => d.rate);
            
            bnbRateChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'BNB‰∏≠ÂçàÂåØÁéá (USDT)',
                        data: rates,
                        borderColor: 'rgba(251, 191, 36, 1)',
                        backgroundColor: 'rgba(251, 191, 36, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        },
                        x: {
                            ticks: { color: '#9CA3AF', maxTicksLimit: 10 },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        }
                    }
                }
            });
        }

        // ÊØèÊó•Âà∑ÂàÜË∂®Âã¢Âúñ
        function initDailyPointsChart() {
            const ctx = document.getElementById('dailyPointsChart').getContext('2d');
            
            if (dailyPointsChart) {
                dailyPointsChart.destroy();
            }
            
            const recentRecords = dailyRecords
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(-30);
            
            const dates = recentRecords.map(r => r.date.substr(5));
            const points = recentRecords.map(r => r.points);
            
            dailyPointsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'ÊØèÊó•Âà∑ÂàÜ',
                        data: points,
                        borderColor: 'rgba(59, 130, 246, 1)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        },
                        x: {
                            ticks: { color: '#9CA3AF', maxTicksLimit: 10 },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        }
                    }
                }
            });
        }

        // ÊàêÊú¨ÁµÑÊàêÂàÜÊûêÂúñ
        function initCostAnalysisChart() {
            const ctx = document.getElementById('costAnalysisChart').getContext('2d');
            
            if (costAnalysisChart) {
                costAnalysisChart.destroy();
            }
            
            const recentCosts = costs
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(-30);
            
            const dates = recentCosts.map(c => c.date.substr(5));
            const gasFees = recentCosts.map(c => c.usdtValue || 0);
            const slippages = recentCosts.map(c => c.slippage || 0);
            
            costAnalysisChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'GasË≤ª (USDT)',
                            data: gasFees,
                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Á£®Êêç (USDT)',
                            data: slippages,
                            backgroundColor: 'rgba(245, 158, 11, 0.8)',
                            borderColor: 'rgba(245, 158, 11, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            stacked: true,
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        },
                        x: {
                            stacked: true,
                            ticks: { color: '#9CA3AF', maxTicksLimit: 10 },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        }
                    }
                }
            });
        }

        function generateCSV(data, filename) {
            let csv = '';
            
            csv += 'Êó•Êúü,È°ûÂûã,È†ÖÁõÆ,Êï∏ÂÄº,USDTÂÉπÂÄº,ÂåØÁéá,ÂÇôË®ª\n';
            
            data.daily?.forEach(record => {
                csv += `${record.date},Âà∑ÂàÜ,ÊØèÊó•Á©çÂàÜ,${record.points},,,""\n`;
            });
            
            data.airdrops?.forEach(airdrop => {
                csv += `${airdrop.date},Á©∫Êäï,${airdrop.token},${formatCrypto(airdrop.amount)},${formatCrypto(airdrop.usdtValue)},,"-15ÂàÜ"\n`;
            });
            
            data.costs?.forEach(cost => {
                if (cost.bnbAmount > 0) {
                    csv += `${cost.date},ÊàêÊú¨,GasË≤ª,${formatCrypto(cost.bnbAmount)},${formatCrypto(cost.usdtValue)},${formatCrypto(cost.bnbRate)},"BNB"\n`;
                }
                if (cost.slippage > 0) {
                    csv += `${cost.date},ÊàêÊú¨,Á£®Êêç,${formatCrypto(cost.slippage)},${formatCrypto(cost.slippage)},,USDT\n`;
                }
            });
            
            const BOM = '\uFEFF';
            const csvWithBOM = BOM + csv;
            
            const blob = new Blob([csvWithBOM], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        function exportAllData() {
            const data = {
                daily: dailyRecords,
                airdrops: airdrops,
                costs: costs
            };
            generateCSV(data, `AlphaÁ©çÂàÜËøΩËπ§_ÂÖ®ÈÉ®Êï∏Êìö_${new Date().toISOString().split('T')[0]}.csv`);
        }

        function exportMonthData() {
            const currentMonth = new Date().toISOString().substr(0, 7);
            
            const data = {
                daily: dailyRecords.filter(r => r.date.startsWith(currentMonth)),
                airdrops: airdrops.filter(r => r.date.startsWith(currentMonth)),
                costs: costs.filter(r => r.date.startsWith(currentMonth))
            };
            generateCSV(data, `AlphaÁ©çÂàÜËøΩËπ§_${currentMonth}_ÊúàÂ∫¶Êï∏Êìö.csv`);
        }

        function exportQuarterData() {
            const threeMonthsAgo = new Date();
            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
            const cutoffDate = threeMonthsAgo.toISOString().split('T')[0];
            
            const data = {
                daily: dailyRecords.filter(r => r.date >= cutoffDate),
                airdrops: airdrops.filter(r => r.date >= cutoffDate),
                costs: costs.filter(r => r.date >= cutoffDate)
            };
            generateCSV(data, `AlphaÁ©çÂàÜËøΩËπ§_Ëøë3ÂÄãÊúà_${new Date().toISOString().split('T')[0]}.csv`);
        }

        function updateDisplay() {
            const stats = calculate15DayStats();
            const totalCosts = calculateTotalCosts();
            
            document.getElementById('netPoints').textContent = stats.netPoints;
            document.getElementById('dateRange').textContent = `ÁØÑÂúç: ${stats.dateRange}`;
            document.getElementById('remainingPoints').textContent = `ÈÇÑÈúÄ ${stats.remainingPoints} ÂàÜ`;
            document.getElementById('airdropCount').textContent = airdrops.length;
            document.getElementById('airdropDeduction').textContent = `Êâ£ ${airdrops.length * 15} ÂàÜ`;
            document.getElementById('totalCost').textContent = formatCrypto(totalCosts.gasFee + totalCosts.slippage);
            
            document.getElementById('progressText').textContent = `${stats.netPoints}/${targetPoints} ÂàÜ`;
            const progressPercent = Math.min((stats.netPoints / targetPoints) * 100, 100);
            document.getElementById('progressBar').style.width = `${progressPercent}%`;
            
            if (stats.remainingPoints > 0) {
                document.getElementById('progressStatus').textContent = `ÈÇÑÈúÄË¶Å ${stats.remainingPoints} ÂàÜÈÅîÂà∞ÁõÆÊ®ô`;
                document.getElementById('progressStatus').className = 'text-gray-400 text-sm mt-3';
            } else {
                document.getElementById('progressStatus').textContent = 'üéâ ÊÅ≠ÂñúÈÅîÊàêÁõÆÊ®ôÔºÅ';
                document.getElementById('progressStatus').className = 'text-neon-green text-sm mt-3 font-bold';
            }
            
            document.getElementById('statsDateRange').textContent = `Áµ±Ë®àÁØÑÂúç: ${stats.dateRange} (Ââç15Â§©Ôºå‰∏çÂê´‰ªäÊó•)`;
            document.getElementById('statsGrossPoints').textContent = `${stats.grossPoints} ÂàÜ`;
            document.getElementById('statsAirdropDeducted').textContent = `-${stats.airdropsDeducted} ÂàÜ`;
            document.getElementById('statsNetPoints').textContent = `${stats.netPoints} ÂàÜ`;
            document.getElementById('statsTarget').textContent = `${targetPoints} ÂàÜ`;
            document.getElementById('statsRemaining').textContent = `${stats.remainingPoints} ÂàÜ`;
            document.getElementById('statsAirdropTotal').textContent = `${airdrops.length} Ê¨°`;
            
            const airdropRevenue = airdrops.reduce((sum, a) => sum + a.usdtValue, 0);
            const totalCostValue = totalCosts.gasFee + totalCosts.slippage;
            const netRevenue = airdropRevenue - totalCostValue;
            
            document.getElementById('statsAirdropRevenue').textContent = `${formatCrypto(airdropRevenue)} USDT`;
            document.getElementById('statsTotalCost').textContent = `${formatCrypto(totalCostValue)} USDT`;
            document.getElementById('statsNetRevenue').textContent = `${formatCrypto(netRevenue)} USDT`;
            
            updateRecordLists();
        }

        function updateRecordLists() {
            updateDailyRecordsList();
            updateAirdropsList();
            updateCostsList();
        }

        function updateDailyRecordsList() {
            const container = document.getElementById('dailyRecords');
            const pagination = document.getElementById('dailyPagination');
            const sorted = dailyRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (sorted.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8 text-lg">üìù Â∞öÁÑ°Âà∑ÂàÜË®òÈåÑ</div>';
                pagination.classList.add('hidden');
                return;
            }
            
            const totalPages = Math.ceil(sorted.length / itemsPerPage);
            const startIndex = (dailyCurrentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, sorted.length);
            const pageItems = sorted.slice(startIndex, endIndex);
            
            container.innerHTML = pageItems.map(record => `
                <div class="record-card p-4 rounded-xl">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-300 font-medium">${record.date}</span>
                        <span class="text-neon-yellow font-bold text-lg">+${record.points} ÂàÜ</span>
                    </div>
                </div>
            `).join('');
            
            if (totalPages > 1) {
                pagination.classList.remove('hidden');
                document.getElementById('dailyPageInfo').textContent = `Á¨¨ ${dailyCurrentPage} È†ÅÔºåÂÖ± ${totalPages} È†Å`;
            } else {
                pagination.classList.add('hidden');
            }
        }

        function updateAirdropsList() {
            const container = document.getElementById('airdropRecords');
            const pagination = document.getElementById('airdropPagination');
            const sorted = airdrops.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (sorted.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8 text-lg">üéÅ Â∞öÁÑ°Á©∫ÊäïË®òÈåÑ</div>';
                pagination.classList.add('hidden');
                return;
            }
            
            const totalPages = Math.ceil(sorted.length / itemsPerPage);
            const startIndex = (airdropCurrentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, sorted.length);
            const pageItems = sorted.slice(startIndex, endIndex);
            
            container.innerHTML = pageItems.map(airdrop => `
                <div class="record-card p-4 rounded-xl">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="flex items-center gap-3 mb-1">
                                <span class="text-neon-green font-bold text-lg">${airdrop.token}</span>
                                <span class="text-gray-400">x${formatCrypto(airdrop.amount)}</span>
                            </div>
                            <span class="text-gray-500 text-sm">${airdrop.date}</span>
                        </div>
                        <div class="text-right">
                            <div class="text-neon-green font-bold text-lg">${formatCrypto(airdrop.usdtValue)} USDT</div>
                            <div class="text-neon-red text-sm">-15ÂàÜ</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            if (totalPages > 1) {
                pagination.classList.remove('hidden');
                document.getElementById('airdropPageInfo').textContent = `Á¨¨ ${airdropCurrentPage} È†ÅÔºåÂÖ± ${totalPages} È†Å`;
            } else {
                pagination.classList.add('hidden');
            }
        }

        function updateCostsList() {
            const container = document.getElementById('costRecords');
            const pagination = document.getElementById('costPagination');
            const sorted = costs.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (sorted.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8 text-lg">üí∏ Â∞öÁÑ°ÊàêÊú¨Ë®òÈåÑ</div>';
                pagination.classList.add('hidden');
                return;
            }
            
            const totalPages = Math.ceil(sorted.length / itemsPerPage);
            const startIndex = (costCurrentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, sorted.length);
            const pageItems = sorted.slice(startIndex, endIndex);
            
            container.innerHTML = pageItems.map(cost => `
                <div class="record-card p-4 rounded-xl">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-300 font-medium">${cost.date}</span>
                        <div class="text-right">
                            ${cost.bnbAmount > 0 ? `
                                <div class="text-neon-red font-medium">
                                    ${formatCrypto(cost.bnbAmount)} BNB ‚Üí ${formatCrypto(cost.usdtValue)} USDT
                                    <div class="text-xs text-gray-400">@ ${formatCrypto(cost.bnbRate)} USDT/BNB</div>
                                </div>
                            ` : ''}
                            ${cost.slippage > 0 ? `<div class="text-orange-400 font-medium mt-1">Á£®Êêç: ${formatCrypto(cost.slippage)} USDT</div>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            
            if (totalPages > 1) {
                pagination.classList.remove('hidden');
                document.getElementById('costPageInfo').textContent = `Á¨¨ ${costCurrentPage} È†ÅÔºåÂÖ± ${totalPages} È†Å`;
            } else {
                pagination.classList.add('hidden');
            }
        }

        console.log('üöÄ AlphaÁ©çÂàÜËøΩËπ§Âô® FirebaseÊúÄÂ∞èÂåñ‰øÆÊ≠£ÁâàÂ∑≤ÂïüÂãïÔºÅ');
    </script>
</body>
</html>
