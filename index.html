<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ Alphaç©åˆ†è¿½è¹¤å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK v9 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, getDocs, getDoc, query, orderBy, onSnapshot, setDoc } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        // ğŸ”¥ Firebase é…ç½® - è«‹æ›¿æ›ç‚ºæ‚¨çš„é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyDMofD3aNCKr93VuX6yCBINpaTlm-4S3kE",
            authDomain: "alpha-tracker-e0a04.firebaseapp.com",
            projectId: "alpha-tracker-e0a04",
            storageBucket: "alpha-tracker-e0a04.firebasestorage.app",
            messagingSenderId: "373250511486",
            appId: "1:373250511486:web:eb22c6c69289b677c3be2f"
        };

        // åˆå§‹åŒ– Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // å°‡ Firebase å¯¦ä¾‹æš´éœ²åˆ°å…¨å±€
        window.db = db;
        window.firebaseModules = {
            collection, addDoc, updateDoc, deleteDoc, doc, getDocs, getDoc, query, orderBy, onSnapshot, setDoc
        };
        
        console.log('ğŸ”¥ Firebase å·²åˆå§‹åŒ–');
    </script>
    
    <!-- Chart.js åœ–è¡¨åº« -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        :root {
            --cyber-dark: #0F172A;
            --cyber-gray: #1E293B;
            --cyber-light: #334155;
            --neon-yellow: #FBBF24;
            --neon-green: #10B981;
            --neon-red: #EF4444;
            --neon-blue: #3B82F6;
        }
        
        body {
            background: linear-gradient(135deg, var(--cyber-dark) 0%, var(--cyber-gray) 50%, var(--cyber-light) 100%);
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(251, 191, 36, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .neon-glow {
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }
        
        .input-glow:focus {
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1), 0 0 15px rgba(251, 191, 36, 0.2);
            border-color: var(--neon-yellow);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--neon-yellow), #F59E0B);
            color: #1F2937;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(45deg, #F59E0B, #D97706);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(251, 191, 36, 0.4);
        }
        
        .btn-green {
            background: linear-gradient(45deg, var(--neon-green), #059669);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-green:hover {
            background: linear-gradient(45deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }
        
        .btn-red {
            background: linear-gradient(45deg, var(--neon-red), #DC2626);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-red:hover {
            background: linear-gradient(45deg, #DC2626, #B91C1C);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
        }
        
        .btn-blue {
            background: linear-gradient(45deg, var(--neon-blue), #2563EB);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-blue:hover {
            background: linear-gradient(45deg, #2563EB, #1D4ED8);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }
        
        .btn-gray {
            background: linear-gradient(45deg, #6B7280, #4B5563);
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-gray:hover {
            background: linear-gradient(45deg, #4B5563, #374151);
            transform: translateY(-1px);
        }
        
        .tab-active {
            background: linear-gradient(45deg, var(--neon-yellow), #F59E0B);
            color: #1F2937;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
        }
        
        .tab-inactive {
            color: #9CA3AF;
            transition: all 0.3s ease;
        }
        
        .tab-inactive:hover {
            color: white;
            background: rgba(75, 85, 99, 0.3);
        }
        
        .record-card {
            background: rgba(51, 65, 85, 0.5);
            border: 1px solid rgba(75, 85, 99, 0.3);
            transition: all 0.3s ease;
        }
        
        .record-card:hover {
            background: rgba(51, 65, 85, 0.8);
            border-color: rgba(251, 191, 36, 0.3);
            transform: translateY(-1px);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, var(--neon-yellow), #F59E0B, var(--neon-yellow));
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .text-neon-yellow { color: var(--neon-yellow); }
        .text-neon-green { color: var(--neon-green); }
        .text-neon-red { color: var(--neon-red); }
        .text-neon-blue { color: var(--neon-blue); }
        
        .bg-cyber-dark { background-color: var(--cyber-dark); }
        .bg-cyber-gray { background-color: var(--cyber-gray); }
        .bg-cyber-light { background-color: var(--cyber-light); }
        
        .border-neon-yellow { border-color: var(--neon-yellow); }
        .border-neon-green { border-color: var(--neon-green); }
        .border-neon-red { border-color: var(--neon-red); }
        
        .stat-card-yellow {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.05));
            border: 1px solid rgba(251, 191, 36, 0.2);
        }
        
        .stat-card-green {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.2);
        }
        
        .stat-card-red {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
            border: 1px solid rgba(239, 68, 68, 0.2);
        }
        
        .info-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .sync-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .sync-online {
            background: rgba(16, 185, 129, 0.2);
            color: var(--neon-green);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .sync-offline {
            background: rgba(239, 68, 68, 0.2);
            color: var(--neon-red);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .sync-syncing {
            background: rgba(251, 191, 36, 0.2);
            color: var(--neon-yellow);
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        
        .pagination-btn {
            background: rgba(75, 85, 99, 0.3);
            border: 1px solid rgba(75, 85, 99, 0.5);
            color: #9CA3AF;
            transition: all 0.3s ease;
        }
        
        .pagination-btn:hover {
            background: rgba(251, 191, 36, 0.2);
            border-color: rgba(251, 191, 36, 0.5);
            color: var(--neon-yellow);
        }
        
        .pagination-btn.active {
            background: linear-gradient(45deg, var(--neon-yellow), #F59E0B);
            color: #1F2937;
            border-color: var(--neon-yellow);
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="text-white">
    <div class="max-w-6xl mx-auto p-6">
        
        <!-- Header -->
        <div class="text-center mb-12 relative z-10">
            <h1 class="text-6xl font-bold mb-4 tracking-tight relative">
                <span class="inline-block mr-4 text-6xl">ğŸš€</span>
                <span style="background: linear-gradient(45deg, var(--neon-yellow), #F97316); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Alphaç©åˆ†è¿½è¹¤å™¨</span>
            </h1>
            
            <!-- é›²ç«¯åŒæ­¥ç‹€æ…‹ -->
            <div class="mb-6">
                <div id="syncStatus" class="sync-indicator sync-offline mx-auto">
                    <span id="syncIcon">âš ï¸</span>
                    <span id="syncText">ç­‰å¾…Firebaseé€£ç·š</span>
                </div>
            </div>
            
            <!-- ç›®æ¨™è¨­å®š -->
            <div class="glass-card rounded-2xl p-6 inline-block">
                <div class="flex items-center justify-center gap-4">
                    <span class="text-gray-300 text-lg">ğŸ¯ ç›®æ¨™ç©åˆ†:</span>
                    <input
                        type="number"
                        id="targetPoints"
                        value="150"
                        class="bg-cyber-gray text-neon-yellow px-4 py-2 rounded-xl border border-gray-600 input-glow focus:outline-none text-xl font-bold text-center w-24"
                    />
                    <span class="text-gray-300 text-lg">åˆ†</span>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="glass-card stat-card-yellow rounded-2xl p-6 neon-glow">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">15å¤©æ·¨ç©åˆ†</p>
                        <p class="text-4xl font-bold text-neon-yellow mb-1" id="netPoints">0</p>
                        <p class="text-gray-500 text-xs" id="dateRange">ç¯„åœ: --</p>
                        <p class="text-gray-500 text-xs" id="remainingPoints">é‚„éœ€ 0 åˆ†</p>
                    </div>
                    <div class="text-5xl">ğŸ¯</div>
                </div>
            </div>
            
            <div class="glass-card stat-card-green rounded-2xl p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">ç©ºæŠ•æ¬¡æ•¸</p>
                        <p class="text-4xl font-bold text-neon-green mb-1" id="airdropCount">0</p>
                        <p class="text-gray-500 text-xs" id="airdropDeduction">æ‰£ 0 åˆ†</p>
                    </div>
                    <div class="text-5xl">ğŸ</div>
                </div>
            </div>

            <div class="glass-card stat-card-red rounded-2xl p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-400 text-sm uppercase tracking-wide">ç¸½æˆæœ¬</p>
                        <p class="text-4xl font-bold text-neon-red mb-1" id="totalCost">0</p>
                        <p class="text-gray-500 text-xs">USDT</p>
                    </div>
                    <div class="text-5xl">ğŸ’¸</div>
                </div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="glass-card rounded-2xl p-8 mb-12">
            <div class="flex justify-between items-center mb-4">
                <span class="text-gray-300 text-lg">ğŸš€ ç›®æ¨™é€²åº¦</span>
                <span class="text-neon-yellow font-bold text-xl" id="progressText">0/150 åˆ†</span>
            </div>
            <div class="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                <div id="progressBar" class="progress-bar h-4 rounded-full transition-all duration-1000" style="width: 0%"></div>
            </div>
            <p class="text-gray-400 text-sm mt-3" id="progressStatus">é‚„éœ€è¦ 150 åˆ†é”åˆ°ç›®æ¨™</p>
        </div>

        <!-- Tab Navigation -->
        <div class="flex bg-cyber-gray rounded-2xl p-2 mb-8 gap-2">
            <button onclick="switchTab('daily')" id="tab-daily" class="tab-btn flex-1 flex items-center justify-center gap-3 py-4 px-6 rounded-xl transition-all text-lg font-semibold tab-active">
                ğŸ“… æ¯æ—¥åˆ·åˆ†
            </button>
            <button onclick="switchTab('cost')" id="tab-cost" class="tab-btn flex-1 flex items-center justify-center gap-3 py-4 px-6 rounded-xl transition-all text-lg font-semibold tab-inactive">
                ğŸ’¸ æˆæœ¬è¿½è¹¤
            </button>
            <button onclick="switchTab('airdrop')" id="tab-airdrop" class="tab-btn flex-1 flex items-center justify-center gap-3 py-4 px-6 rounded-xl transition-all text-lg font-semibold tab-inactive">
                ğŸ ç©ºæŠ•è¨˜éŒ„
            </button>
            <button onclick="switchTab('charts')" id="tab-charts" class="tab-btn flex-1 flex items-center justify-center gap-3 py-4 px-6 rounded-xl transition-all text-lg font-semibold tab-inactive">
                ğŸ“Š è¶¨å‹¢åˆ†æ
            </button>
            <button onclick="switchTab('analysis')" id="tab-analysis" class="tab-btn flex-1 flex items-center justify-center gap-3 py-4 px-6 rounded-xl transition-all text-lg font-semibold tab-inactive">
                ğŸ“ˆ æ•¸æ“šå°å‡º
            </button>
        </div>

        <!-- Content Areas -->
        <div class="glass-card rounded-2xl p-8">
            <!-- Daily Points Tab -->
            <div id="daily-content" class="tab-content">
                <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    ğŸ“… æ¯æ—¥åˆ·åˆ†è¨˜éŒ„
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <input type="date" id="dailyDate" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none transition-all">
                    <input type="number" id="dailyPoints" placeholder="ç•¶æ—¥åˆ·åˆ†" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none transition-all">
                    <button onclick="addDailyRecord()" class="btn-primary px-6 py-3 rounded-xl text-lg">
                        â• æ·»åŠ è¨˜éŒ„
                    </button>
                </div>

                <div id="dailyRecords" class="space-y-3">
                    <div class="text-center text-gray-500 py-8 text-lg">ğŸ“ å°šç„¡åˆ·åˆ†è¨˜éŒ„</div>
                </div>
                
                <!-- åˆ†é æ§åˆ¶ -->
                <div id="dailyPagination" class="hidden flex justify-center items-center gap-2 mt-6">
                    <button onclick="changeDailyPage(-1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">â¬…ï¸ ä¸Šä¸€é </button>
                    <span id="dailyPageInfo" class="text-gray-400 px-4">ç¬¬ 1 é ï¼Œå…± 1 é </span>
                    <button onclick="changeDailyPage(1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">ä¸‹ä¸€é  â¡ï¸</button>
                </div>
            </div>

            <!-- Cost Tab -->
            <div id="cost-content" class="tab-content hidden">
                <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    ğŸ’¸ æˆæœ¬è¿½è¹¤ 
                    <span id="loadingIndicator" class="text-neon-yellow text-sm px-3 py-1 rounded-full hidden animate-pulse" style="background: rgba(251, 191, 36, 0.2);">æ­£åœ¨ç²å–åŒ¯ç‡...</span>
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <input type="date" id="costDate" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-red transition-all">
                    <input type="number" id="costBnb" step="0.00000001" placeholder="Gas Fee (BNB)" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-red transition-all">
                    <input type="number" id="costSlippage" step="0.00000001" placeholder="ç£¨æ (USDT)" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-red transition-all">
                    <button onclick="addCost()" class="btn-red px-6 py-3 rounded-xl">
                        â• æ·»åŠ æˆæœ¬
                    </button>
                </div>

                <div id="costRecords" class="space-y-3">
                    <div class="text-center text-gray-500 py-8 text-lg">ğŸ’¸ å°šç„¡æˆæœ¬è¨˜éŒ„</div>
                </div>
                
                <!-- åˆ†é æ§åˆ¶ -->
                <div id="costPagination" class="hidden flex justify-center items-center gap-2 mt-6">
                    <button onclick="changeCostPage(-1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">â¬…ï¸ ä¸Šä¸€é </button>
                    <span id="costPageInfo" class="text-gray-400 px-4">ç¬¬ 1 é ï¼Œå…± 1 é </span>
                    <button onclick="changeCostPage(1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">ä¸‹ä¸€é  â¡ï¸</button>
                </div>
            </div>

            <!-- Airdrop Tab -->
            <div id="airdrop-content" class="tab-content hidden">
                <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    ğŸ ç©ºæŠ•è¨˜éŒ„ <span class="text-sm text-gray-400 bg-cyber-gray px-3 py-1 rounded-full">æ¯æ¬¡æ‰£15åˆ†</span>
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <input type="date" id="airdropDate" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-green transition-all">
                    <input type="text" id="airdropToken" placeholder="ä»£å¹£åç¨±" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-green transition-all">
                    <input type="number" id="airdropAmount" step="0.00000001" placeholder="æ•¸é‡" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-green transition-all">
                    <div class="flex gap-2">
                        <input type="number" id="airdropValue" step="0.00000001" placeholder="USDTæ”¶ç›Š" class="input-glow bg-cyber-gray text-white px-4 py-3 rounded-xl border border-gray-600 focus:outline-none border-neon-green transition-all flex-1">
                        <button onclick="addAirdrop()" class="btn-green px-6 py-3 rounded-xl">
                            â•
                        </button>
                    </div>
                </div>

                <div id="airdropRecords" class="space-y-3">
                    <div class="text-center text-gray-500 py-8 text-lg">ğŸ å°šç„¡ç©ºæŠ•è¨˜éŒ„</div>
                </div>
                
                <!-- åˆ†é æ§åˆ¶ -->
                <div id="airdropPagination" class="hidden flex justify-center items-center gap-2 mt-6">
                    <button onclick="changeAirdropPage(-1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">â¬…ï¸ ä¸Šä¸€é </button>
                    <span id="airdropPageInfo" class="text-gray-400 px-4">ç¬¬ 1 é ï¼Œå…± 1 é </span>
                    <button onclick="changeAirdropPage(1)" class="pagination-btn px-3 py-2 rounded-lg text-sm">ä¸‹ä¸€é  â¡ï¸</button>
                </div>
            </div>

            <!-- Charts Tab -->
            <div id="charts-content" class="tab-content hidden">
                <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    ğŸ“Š è¶¨å‹¢åˆ†æèˆ‡è¦–è¦ºåŒ–
                </h3>
                
                <!-- å¿«é€Ÿçµ±è¨ˆæ¦‚è¦½ -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="info-box p-4 rounded-xl text-center">
                        <p class="text-gray-400 text-sm">æœ¬æœˆåˆ·åˆ†</p>
                        <p class="text-neon-yellow text-2xl font-bold" id="monthlyPoints">0</p>
                    </div>
                    <div class="info-box p-4 rounded-xl text-center">
                        <p class="text-gray-400 text-sm">æœ¬æœˆç©ºæŠ•</p>
                        <p class="text-neon-green text-2xl font-bold" id="monthlyAirdrops">0</p>
                    </div>
                    <div class="info-box p-4 rounded-xl text-center">
                        <p class="text-gray-400 text-sm">æœ¬æœˆæˆæœ¬</p>
                        <p class="text-neon-red text-2xl font-bold" id="monthlyCosts">0</p>
                    </div>
                    <div class="info-box p-4 rounded-xl text-center">
                        <p class="text-gray-400 text-sm">æœ¬æœˆROI</p>
                        <p class="text-neon-blue text-2xl font-bold" id="monthlyROI">0%</p>
                    </div>
                </div>
                
                <!-- åœ–è¡¨å€åŸŸ -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- æœˆåº¦æ”¶ç›Šå°æ¯” -->
                    <div class="glass-card p-6 rounded-xl">
                        <h4 class="text-lg font-bold mb-4 flex items-center gap-2">
                            ğŸ’° æœˆåº¦æ”¶ç›Šå°æ¯” (ç©ºæŠ• vs æˆæœ¬)
                        </h4>
                        <div class="relative h-64">
                            <canvas id="monthlyRevenueChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- BNBåŒ¯ç‡è¶¨å‹¢ -->
                    <div class="glass-card p-6 rounded-xl">
                        <h4 class="text-lg font-bold mb-4 flex items-center gap-2">
                            ğŸ“ˆ BNBä¸­åˆåŒ¯ç‡è¶¨å‹¢ (è¿‘30å¤©)
                        </h4>
                        <div class="relative h-64">
                            <canvas id="bnbRateChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <!-- æ¯æ—¥åˆ·åˆ†è¶¨å‹¢ -->
                    <div class="glass-card p-6 rounded-xl">
                        <h4 class="text-lg font-bold mb-4 flex items-center gap-2">
                            ğŸ“… æ¯æ—¥åˆ·åˆ†è¶¨å‹¢ (è¿‘30å¤©)
                        </h4>
                        <div class="relative h-64">
                            <canvas id="dailyPointsChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- æˆæœ¬/ç£¨æåˆ†æ -->
                    <div class="glass-card p-6 rounded-xl">
                        <h4 class="text-lg font-bold mb-4 flex items-center gap-2">
                            ğŸ’¸ æˆæœ¬çµ„æˆåˆ†æ (è¿‘30å¤©)
                        </h4>
                        <div class="relative h-64">
                            <canvas id="costAnalysisChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- æ™ºèƒ½å»ºè­° -->
                <div class="glass-card p-8 rounded-xl">
                    <h4 class="text-xl font-bold mb-6 flex items-center gap-3">
                        ğŸ“‹ æ™ºèƒ½åˆ†æå ±è¡¨
                    </h4>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- æœˆåº¦å ±å‘Š -->
                        <div class="info-box p-6 rounded-xl">
                            <h5 class="font-bold text-neon-blue mb-4">ğŸ“… æœ¬æœˆç¸½çµ</h5>
                            <div id="monthlyReport" class="space-y-2 text-sm">
                                <p>è¼‰å…¥ä¸­...</p>
                            </div>
                        </div>
                        
                        <!-- å­£åº¦åˆ†æ -->
                        <div class="info-box p-6 rounded-xl">
                            <h5 class="font-bold text-neon-green mb-4">ğŸ“Š å­£åº¦åˆ†æ</h5>
                            <div id="quarterlyReport" class="space-y-2 text-sm">
                                <p>è¼‰å…¥ä¸­...</p>
                            </div>
                        </div>
                        
                        <!-- æ™ºèƒ½å»ºè­° -->
                        <div class="info-box p-6 rounded-xl">
                            <h5 class="font-bold text-neon-yellow mb-4">ğŸ’¡ æ•¸æ“šå»ºè­°</h5>
                            <div id="smartSuggestions" class="space-y-2 text-sm">
                                <p>è¼‰å…¥ä¸­...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analysis Tab -->
            <div id="analysis-content" class="tab-content hidden">
                <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    ğŸ“ˆ æ•¸æ“šåˆ†æèˆ‡å°å‡º
                </h3>
                
                <!-- æ•¸æ“šå°å‡ºå€åŸŸ -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="info-box p-6 rounded-xl text-center">
                        <div class="text-4xl mb-3">ğŸ“Š</div>
                        <h4 class="text-neon-blue font-bold mb-3">å®Œæ•´æ•¸æ“š</h4>
                        <p class="text-sm text-blue-100 mb-4">å°å‡ºæ‰€æœ‰æ­·å²è¨˜éŒ„ï¼Œé©åˆæ·±åº¦åˆ†æ</p>
                        <button onclick="exportAllData()" class="btn-blue px-6 py-2 rounded-lg w-full">
                            ä¸‹è¼‰ CSV
                        </button>
                    </div>
                    
                    <div class="info-box p-6 rounded-xl text-center">
                        <div class="text-4xl mb-3">ğŸ“…</div>
                        <h4 class="text-neon-blue font-bold mb-3">ç•¶æœˆæ•¸æ“š</h4>
                        <p class="text-sm text-blue-100 mb-4">å°å‡ºæœ¬æœˆè¨˜éŒ„ï¼Œé©åˆæœˆåº¦å›é¡§</p>
                        <button onclick="exportMonthData()" class="btn-blue px-6 py-2 rounded-lg w-full">
                            ä¸‹è¼‰ CSV
                        </button>
                    </div>
                    
                    <div class="info-box p-6 rounded-xl text-center">
                        <div class="text-4xl mb-3">ğŸ“ˆ</div>
                        <h4 class="text-neon-blue font-bold mb-3">è¿‘3å€‹æœˆ</h4>
                        <p class="text-sm text-blue-100 mb-4">å°å‡ºå­£åº¦æ•¸æ“šï¼Œé©åˆè¶¨å‹¢åˆ†æ</p>
                        <button onclick="exportQuarterData()" class="btn-blue px-6 py-2 rounded-lg w-full">
                            ä¸‹è¼‰ CSV
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Stats -->
        <div class="glass-card rounded-2xl p-8 mt-12">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold flex items-center gap-3">ğŸ“Š 15å¤©è©³ç´°çµ±è¨ˆ</h3>
                <div class="flex gap-2">
                    <button onclick="clearAllData()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                        ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•¸æ“š
                    </button>
                </div>
            </div>
            <p class="text-gray-400 text-sm mb-8 bg-cyber-gray px-4 py-2 rounded-lg" id="statsDateRange">çµ±è¨ˆç¯„åœ: -- (å‰15å¤©ï¼Œä¸å«ä»Šæ—¥)</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">åˆ·åˆ†ç¸½è¨ˆ:</span>
                        <span class="text-neon-yellow font-bold text-lg" id="statsGrossPoints">0 åˆ†</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">ç©ºæŠ•æ‰£åˆ†:</span>
                        <span class="text-neon-red font-bold text-lg" id="statsAirdropDeducted">-0 åˆ†</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">æ·¨ç©åˆ†:</span>
                        <span class="text-neon-green font-bold text-lg" id="statsNetPoints">0 åˆ†</span>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">ç©ºæŠ•æ”¶ç›Š:</span>
                        <span class="text-neon-green font-bold text-lg" id="statsAirdropRevenue">0 USDT</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">ç¸½æˆæœ¬:</span>
                        <span class="text-neon-red font-bold text-lg" id="statsTotalCost">0 USDT</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">æ·¨æ”¶ç›Š:</span>
                        <span class="text-neon-blue font-bold text-lg" id="statsNetRevenue">0 USDT</span>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">ç›®æ¨™è¨­å®š:</span>
                        <span class="text-neon-yellow font-bold text-lg" id="statsTarget">150 åˆ†</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">è·é›¢ç›®æ¨™:</span>
                        <span class="text-neon-blue font-bold text-lg" id="statsRemaining">150 åˆ†</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400">ç©ºæŠ•ç¸½æ•¸:</span>
                        <span class="text-neon-green font-bold text-lg" id="statsAirdropTotal">0 æ¬¡</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ğŸ”¥ Firebase é›²ç«¯åŒæ­¥ç‰ˆæœ¬ - æœ€å°åŒ–ä¿®æ­£ç‰ˆ
        
        // æ•¸æ“šå­˜å„²
        let dailyRecords = [];
        let airdrops = [];
        let costs = [];
        let targetPoints = 150;
        let bnbRateCache = {};
        let lastSelectedRateInfo = null;

        // åˆ†é ç‹€æ…‹
        let dailyCurrentPage = 1;
        let airdropCurrentPage = 1;
        let costCurrentPage = 1;
        const itemsPerPage = 10;

        // Firebase é€£ç·šç‹€æ…‹
        let isFirebaseReady = false;
        let syncStatus = 'offline';

        // åœ–è¡¨å¯¦ä¾‹
        let monthlyRevenueChart = null;
        let bnbRateChart = null;
        let dailyPointsChart = null;
        let costAnalysisChart = null;

        // ğŸ”¥ ä¿®æ­£ç‰ˆ Firebase æ•¸æ“šåŒæ­¥å‡½æ•¸ - çœŸæ­£çš„åŒæ­¥ç‰ˆæœ¬
        async function saveToFirebase() {
            if (!isFirebaseReady) {
                console.log('Firebase å°šæœªæº–å‚™å¥½ï¼Œæš«å­˜åˆ°æœ¬åœ°');
                return false;
            }

            try {
                updateSyncStatus('syncing');
                const { setDoc, doc } = window.firebaseModules;
                
                // ç°¡å–®çš„æ•¸æ“šçµæ§‹ï¼Œä¸€æ¬¡æ€§ä¿å­˜æ‰€æœ‰æ•¸æ“š
                const userData = {
                    dailyRecords,
                    airdrops,
                    costs,
                    settings: {
                        targetPoints,
                        bnbRateCache,
                        lastSelectedRateInfo
                    },
                    lastUpdated: new Date().toISOString(),
                    timestamp: Date.now()
                };

                // ä¿å­˜åˆ°å›ºå®šæ–‡æª” ID
                await setDoc(doc(window.db, 'users', 'defaultUser'), userData);
                
                console.log('âœ… è³‡æ–™å·²æˆåŠŸåŒæ­¥åˆ° Firebase', userData);
                updateSyncStatus('online');
                return true;
            } catch (error) {
                console.error('âŒ Firebase åŒæ­¥å¤±æ•—:', error);
                updateSyncStatus('offline');
                return false;
            }
        }

        async function loadFromFirebase() {
            if (!isFirebaseReady) {
                console.log('Firebase å°šæœªæº–å‚™å¥½ï¼Œå¾æœ¬åœ°åŠ è¼‰');
                return false;
            }

            try {
                updateSyncStatus('syncing');
                const { doc, getDoc } = window.firebaseModules;
                
                // å¾å›ºå®šæ–‡æª”è®€å–æ•¸æ“š
                const docRef = doc(window.db, 'users', 'defaultUser');
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const userData = docSnap.data();
                    console.log('ğŸ”¥ å¾ Firebase è®€å–åˆ°æ•¸æ“š:', userData);
                    
                    // æ¢å¾©æ•¸æ“š
                    dailyRecords = userData.dailyRecords || [];
                    airdrops = userData.airdrops || [];
                    costs = userData.costs || [];
                    
                    if (userData.settings) {
                        targetPoints = userData.settings.targetPoints || 150;
                        bnbRateCache = userData.settings.bnbRateCache || {};
                        lastSelectedRateInfo = userData.settings.lastSelectedRateInfo || null;
                    }
                    
                    console.log(`âœ… Firebase æ•¸æ“šè¼‰å…¥æˆåŠŸ: ${dailyRecords.length}ç­†åˆ·åˆ†, ${airdrops.length}ç­†ç©ºæŠ•, ${costs.length}ç­†æˆæœ¬`);
                    updateSyncStatus('online');
                    return true;
                } else {
                    console.log('ğŸ”¥ Firebase ä¸­æ²’æœ‰æ•¸æ“šï¼Œä½¿ç”¨æœ¬åœ°æ•¸æ“š');
                    updateSyncStatus('online');
                    return true;
                }
            } catch (error) {
                console.error('âŒ Firebase è¼‰å…¥å¤±æ•—:', error);
                updateSyncStatus('offline');
                return false;
            }
        }

        // æœ¬åœ°å„²å­˜å‚™ä»½å‡½æ•¸ - ä¿æŒåŸæ¨£
        function saveToLocalStorage() {
            try {
                localStorage.setItem('alpha-dailyRecords', JSON.stringify(dailyRecords));
                localStorage.setItem('alpha-airdrops', JSON.stringify(airdrops));
                localStorage.setItem('alpha-costs', JSON.stringify(costs));
                localStorage.setItem('alpha-settings', JSON.stringify({ 
                    targetPoints, 
                    bnbRateCache, 
                    lastSelectedRateInfo 
                }));
                console.log('ğŸ“± æ•¸æ“šå·²ä¿å­˜åˆ°æœ¬åœ°å„²å­˜');
            } catch (error) {
                console.error('æœ¬åœ°å„²å­˜å¤±æ•—:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const loadedDaily = localStorage.getItem('alpha-dailyRecords');
                const loadedAirdrops = localStorage.getItem('alpha-airdrops');
                const loadedCosts = localStorage.getItem('alpha-costs');
                const loadedSettings = localStorage.getItem('alpha-settings');
                
                dailyRecords = loadedDaily ? JSON.parse(loadedDaily) : [];
                airdrops = loadedAirdrops ? JSON.parse(loadedAirdrops) : [];
                costs = loadedCosts ? JSON.parse(loadedCosts) : [];
                
                if (loadedSettings) {
                    const settings = JSON.parse(loadedSettings);
                    targetPoints = settings.targetPoints || 150;
                    bnbRateCache = settings.bnbRateCache || {};
                    lastSelectedRateInfo = settings.lastSelectedRateInfo || null;
                }
                
                console.log(`ğŸ“¦ å¾æœ¬åœ°åŠ è¼‰æ•¸æ“š: ${dailyRecords.length}ç­†åˆ·åˆ†, ${airdrops.length}ç­†ç©ºæŠ•, ${costs.length}ç­†æˆæœ¬`);
            } catch (error) {
                console.error('æœ¬åœ°åŠ è¼‰æ•¸æ“šå¤±æ•—:', error);
            }
        }

        // åŒæ­¥ç‹€æ…‹æ›´æ–° - ä¿æŒåŸæ¨£
        function updateSyncStatus(status) {
            syncStatus = status;
            const statusElement = document.getElementById('syncStatus');
            const iconElement = document.getElementById('syncIcon');
            const textElement = document.getElementById('syncText');
            
            switch (status) {
                case 'online':
                    statusElement.className = 'sync-indicator sync-online mx-auto';
                    iconElement.textContent = 'ğŸ”¥';
                    textElement.textContent = 'Firebase å·²é€£ç·š';
                    break;
                case 'syncing':
                    statusElement.className = 'sync-indicator sync-syncing mx-auto';
                    iconElement.textContent = 'ğŸ”„';
                    textElement.textContent = 'åŒæ­¥ä¸­...';
                    break;
                case 'offline':
                default:
                    statusElement.className = 'sync-indicator sync-offline mx-auto';
                    iconElement.textContent = 'ğŸ“±';
                    textElement.textContent = 'æœ¬åœ°æ¨¡å¼';
                    break;
            }
        }

        // çµ±ä¸€çš„ä¿å­˜æ•¸æ“šå‡½æ•¸ - ä¿®æ­£ç‰ˆæœ¬
        async function saveAllData() {
            // ç¸½æ˜¯ä¿å­˜åˆ°æœ¬åœ°ä½œç‚ºå‚™ä»½
            saveToLocalStorage();
            
            // å¦‚æœFirebaseå¯ç”¨ï¼Œå˜—è©¦åŒæ­¥åˆ°é›²ç«¯
            if (isFirebaseReady && syncStatus === 'online') {
                await saveToFirebase();
            }
        }

        // å…¶é¤˜å‡½æ•¸ä¿æŒä¸è®Š...
        function formatCrypto(number) {
            if (number === 0) return '0';
            return parseFloat(number.toFixed(8)).toString();
        }

        function selectNoonRate(prices, targetDate) {
            console.log(`ğŸ¯ é–‹å§‹æ™ºèƒ½é¸æ“‡ ${targetDate} æœ€æ¥è¿‘å°ç£ä¸­åˆ12:30çš„åŒ¯ç‡...`);
            
            const targetNoon = new Date(targetDate + 'T04:30:00.000Z');
            const targetTimestamp = targetNoon.getTime();
            
            console.log(`ğŸ• ç›®æ¨™æ™‚é–“: å°ç£ ${targetDate} 12:30 (UTC ${targetNoon.toISOString()})`);
            console.log(`ğŸ“Š åˆ†æ ${prices.length} å€‹åƒ¹æ ¼é»...`);
            
            let bestMatch = null;
            let minTimeDiff = Infinity;
            
            prices.forEach((price, index) => {
                const priceTimestamp = price[0];
                const priceRate = price[1];
                const timeDiff = Math.abs(priceTimestamp - targetTimestamp);
                
                const taipeiTime = new Date(priceTimestamp);
                const taipeiHours = (taipeiTime.getUTCHours() + 8) % 24;
                const taipeiMinutes = taipeiTime.getUTCMinutes();
                const timeStr = `${taipeiHours.toString().padStart(2,'0')}:${taipeiMinutes.toString().padStart(2,'0')}`;
                const diffMinutes = Math.round(timeDiff / 60000);
                
                console.log(`â° åƒ¹æ ¼é»${index + 1}: å°åŒ— ${timeStr} - $${priceRate.toFixed(2)} (èˆ‡12:30å·®${diffMinutes}åˆ†é˜)`);
                
                if (timeDiff < minTimeDiff) {
                    minTimeDiff = timeDiff;
                    bestMatch = {
                        rate: priceRate,
                        timestamp: priceTimestamp,
                        timeInfo: timeStr,
                        diffMinutes: diffMinutes,
                        targetDate: targetDate,
                        totalPrices: prices.length,
                        index: index + 1
                    };
                }
            });
            
            if (bestMatch) {
                console.log(`ğŸ† æœ€ä½³é¸æ“‡: åƒ¹æ ¼é»${bestMatch.index} - å°åŒ— ${bestMatch.timeInfo} - $${bestMatch.rate.toFixed(2)}`);
                console.log(`âœ… èˆ‡ç›®æ¨™æ™‚é–“12:30å·®è·: ${bestMatch.diffMinutes}åˆ†é˜`);
                
                lastSelectedRateInfo = {
                    date: targetDate,
                    selectedTime: bestMatch.timeInfo,
                    selectedRate: bestMatch.rate,
                    diffMinutes: bestMatch.diffMinutes,
                    totalPrices: bestMatch.totalPrices,
                    targetTime: "12:30",
                    selectedIndex: bestMatch.index,
                    timestamp: Date.now()
                };
                
                return bestMatch;
            } else {
                const middleIndex = Math.floor(prices.length / 2);
                const fallbackPrice = prices[middleIndex];
                const fallbackTime = new Date(fallbackPrice[0]);
                const fallbackHours = (fallbackTime.getUTCHours() + 8) % 24;
                const fallbackMinutes = fallbackTime.getUTCMinutes();
                const fallbackTimeStr = `${fallbackHours.toString().padStart(2,'0')}:${fallbackMinutes.toString().padStart(2,'0')}`;
                
                console.log(`âš¡ é™ç´šè™•ç†: ä½¿ç”¨ä¸­é–“åƒ¹æ ¼é»${middleIndex + 1} - å°åŒ— ${fallbackTimeStr} - $${fallbackPrice[1].toFixed(2)}`);
                
                lastSelectedRateInfo = {
                    date: targetDate,
                    selectedTime: fallbackTimeStr,
                    selectedRate: fallbackPrice[1],
                    diffMinutes: 'N/A',
                    totalPrices: prices.length,
                    targetTime: "12:30",
                    selectedIndex: middleIndex + 1,
                    fallback: true,
                    timestamp: Date.now()
                };
                
                return {
                    rate: fallbackPrice[1],
                    timeInfo: fallbackTimeStr,
                    diffMinutes: 'N/A'
                };
            }
        }

        async function getBnbRate(date) {
            if (bnbRateCache[date]) {
                console.log(`ğŸ“¦ ä½¿ç”¨ç·©å­˜åŒ¯ç‡ ${date}: $${bnbRateCache[date]}`);
                if (lastSelectedRateInfo && lastSelectedRateInfo.date === date) {
                    return {
                        rate: bnbRateCache[date],
                        timeInfo: lastSelectedRateInfo.selectedTime,
                        diffMinutes: lastSelectedRateInfo.diffMinutes,
                        fromCache: true
                    };
                }
                return { 
                    rate: bnbRateCache[date], 
                    timeInfo: 'ç·©å­˜æ•¸æ“š', 
                    diffMinutes: 'æœªçŸ¥',
                    fromCache: true 
                };
            }
            
            try {
                console.log(`ğŸŒ é–‹å§‹ç²å– ${date} çš„æ™ºèƒ½ä¸­åˆåŒ¯ç‡...`);
                
                const dayStart = new Date(date).setHours(0, 0, 0, 0);
                const dayEnd = new Date(date).setHours(23, 59, 59, 999);
                const fromTimestamp = Math.floor(dayStart / 1000);
                const toTimestamp = Math.floor(dayEnd / 1000);
                
                const apiUrl = `https://api.coingecko.com/api/v3/coins/binancecoin/market_chart/range?vs_currency=usd&from=${fromTimestamp}&to=${toTimestamp}`;
                console.log(`ğŸ“¡ APIè«‹æ±‚: ${apiUrl}`);
                
                const response = await fetch(apiUrl);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.prices && data.prices.length > 0) {
                        console.log(`ğŸ“Š ç²å¾— ${data.prices.length} å€‹åƒ¹æ ¼é»`);
                        
                        const selectedRate = selectNoonRate(data.prices, date);
                        
                        bnbRateCache[date] = selectedRate.rate;
                        await saveAllData();
                        console.log(`âœ… æ™ºèƒ½é¸æ“‡ ${date} BNBåŒ¯ç‡: $${selectedRate.rate.toFixed(2)} (å°åŒ—æ™‚é–“ ${selectedRate.timeInfo})`);
                        
                        return {
                            rate: selectedRate.rate,
                            timeInfo: selectedRate.timeInfo,
                            diffMinutes: selectedRate.diffMinutes,
                            fromCache: false
                        };
                    }
                }
                
                console.log(`âš ï¸ ç„¡æ³•ç²å– ${date} çš„BNBåƒ¹æ ¼ï¼Œä½¿ç”¨é è¨­å€¼ $650`);
                return { 
                    rate: 650, 
                    timeInfo: 'APIç•°å¸¸ï¼Œä½¿ç”¨é è¨­å€¼', 
                    diffMinutes: 'N/A',
                    isDefault: true 
                };
            } catch (error) {
                console.error('âŒ ç²å–BNBåƒ¹æ ¼å¤±æ•—:', error);
                return { 
                    rate: 650, 
                    timeInfo: `ç¶²è·¯éŒ¯èª¤: ${error.message}`, 
                    diffMinutes: 'N/A',
                    isError: true 
                };
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('ğŸš€ Alphaç©åˆ†è¿½è¹¤å™¨ Firebaseæœ€å°åŒ–ä¿®æ­£ç‰ˆåˆå§‹åŒ–é–‹å§‹...');
            
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('dailyDate').value = today;
            document.getElementById('airdropDate').value = today;
            document.getElementById('costDate').value = today;
            
            // å…ˆåŠ è¼‰æœ¬åœ°æ•¸æ“š
            loadFromLocalStorage();
            
            // ç­‰å¾…Firebaseåˆå§‹åŒ–
            setTimeout(async () => {
                try {
                    if (window.db && window.firebaseModules) {
                        isFirebaseReady = true;
                        console.log('ğŸ”¥ Firebase é€£ç·šæ¸¬è©¦...');
                        const success = await loadFromFirebase();
                        if (success) {
                            console.log('ğŸ”¥ Firebase æ•¸æ“šè¼‰å…¥å®Œæˆ');
                            // é‡æ–°è¼‰å…¥å¾Œæ›´æ–°é¡¯ç¤º
                            document.getElementById('targetPoints').value = targetPoints;
                            updateDisplay();
                        }
                    } else {
                        console.log('ğŸ“± Firebase æœªé…ç½®ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å¼');
                        updateSyncStatus('offline');
                    }
                } catch (error) {
                    console.error('Firebase åˆå§‹åŒ–å¤±æ•—:', error);
                    updateSyncStatus('offline');
                }
            }, 1000);
            
            console.log('âœ… Alphaç©åˆ†è¿½è¹¤å™¨ Firebaseæœ€å°åŒ–ä¿®æ­£ç‰ˆåˆå§‹åŒ–å®Œæˆï¼');
        });

        // ç›®æ¨™ç©åˆ†è®Šæ›´
        document.getElementById('targetPoints').addEventListener('change', async function() {
            targetPoints = parseInt(this.value) || 150;
            await saveAllData();
            updateDisplay();
        });

        // æ¨™ç±¤åˆ‡æ›
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            
            document.getElementById(tabName + '-content').classList.remove('hidden');
            const activeTab = document.getElementById('tab-' + tabName);
            activeTab.classList.add('tab-active');
            activeTab.classList.remove('tab-inactive');
            
            if (tabName === 'charts') {
                setTimeout(() => {
                    try {
                        updateMonthlyStats();
                        generateReport();
                        initializeCharts();
                    } catch (error) {
                        console.error('âŒ åœ–è¡¨åˆå§‹åŒ–å¤±æ•—:', error);
                    }
                }, 300);
            }
        }

        // è¨ˆç®—15å¤©çµ±è¨ˆ
        function calculate15DayStats() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const endDate = new Date(today - 1 * 24 * 60 * 60 * 1000);
            const startDate = new Date(today - 15 * 24 * 60 * 60 * 1000);
            
            const recentPoints = dailyRecords
                .filter(record => {
                    const recordDate = new Date(record.date);
                    recordDate.setHours(0, 0, 0, 0);
                    return recordDate >= startDate && recordDate <= endDate;
                })
                .reduce((sum, record) => sum + record.points, 0);
            
            const recentAirdrops = airdrops
                .filter(airdrop => {
                    const airdropDate = new Date(airdrop.date);
                    airdropDate.setHours(0, 0, 0, 0);
                    return airdropDate >= startDate && airdropDate <= endDate;
                })
                .length * 15;
            
            const netPoints = recentPoints - recentAirdrops;
            
            const formatDate = (date) => `${date.getMonth() + 1}/${date.getDate()}`;
            const dateRange = `${formatDate(startDate)} - ${formatDate(endDate)}`;
            
            return {
                grossPoints: recentPoints,
                airdropsDeducted: recentAirdrops,
                netPoints,
                remainingPoints: Math.max(targetPoints - netPoints, 0),
                dateRange
            };
        }

        // è¨ˆç®—ç¸½æˆæœ¬
        function calculateTotalCosts() {
            const totalGasFee = costs.reduce((sum, cost) => sum + (cost.usdtValue || 0), 0);
            const totalSlippage = costs.reduce((sum, cost) => sum + (cost.slippage || 0), 0);
            return { gasFee: totalGasFee, slippage: totalSlippage };
        }

        // æ·»åŠ æ¯æ—¥è¨˜éŒ„
        async function addDailyRecord() {
            const date = document.getElementById('dailyDate').value;
            const points = parseInt(document.getElementById('dailyPoints').value);
            
            if (!date || !points) {
                alert('ğŸš¨ è«‹å¡«å¯«æ—¥æœŸå’Œåˆ·åˆ†æ•¸');
                return;
            }
            
            const existingIndex = dailyRecords.findIndex(record => record.date === date);
            
            if (existingIndex !== -1) {
                const oldPoints = dailyRecords[existingIndex].points;
                dailyRecords[existingIndex].points = points;
                alert(`ğŸ“ å·²æ›´æ–° ${date} çš„è¨˜éŒ„ï¼š${oldPoints}åˆ† â†’ ${points}åˆ†`);
            } else {
                dailyRecords.push({
                    id: Date.now(),
                    date,
                    points
                });
                alert(`ğŸ“ å·²æ–°å¢ ${date} çš„è¨˜éŒ„ï¼š${points}åˆ†`);
            }
            
            document.getElementById('dailyPoints').value = '';
            await saveAllData();
            updateDisplay();
        }

        // æ·»åŠ ç©ºæŠ•è¨˜éŒ„
        async function addAirdrop() {
            const date = document.getElementById('airdropDate').value;
            const token = document.getElementById('airdropToken').value;
            const amount = parseFloat(document.getElementById('airdropAmount').value);
            const value = parseFloat(document.getElementById('airdropValue').value);
            
            if (!date || !token || !amount) {
                alert('ğŸš¨ è«‹å¡«å¯«æ—¥æœŸã€ä»£å¹£åç¨±å’Œæ•¸é‡');
                return;
            }
            
            const existingIndex = airdrops.findIndex(airdrop => 
                airdrop.date === date && airdrop.token.toLowerCase() === token.toLowerCase()
            );
            
            if (existingIndex !== -1) {
                const oldAmount = airdrops[existingIndex].amount;
                const oldValue = airdrops[existingIndex].usdtValue;
                airdrops[existingIndex].amount = amount;
                airdrops[existingIndex].usdtValue = value || 0;
                alert(`ğŸ å·²æ›´æ–° ${date} ${token} çš„è¨˜éŒ„ï¼š\næ•¸é‡ï¼š${oldAmount} â†’ ${amount}\nUSDTï¼š${oldValue} â†’ ${value || 0}`);
            } else {
                airdrops.push({
                    id: Date.now(),
                    date,
                    token,
                    amount,
                    usdtValue: value || 0
                });
                alert(`ğŸ å·²æ–°å¢ ${date} ${token} çš„è¨˜éŒ„ï¼š${amount}å€‹ï¼Œåƒ¹å€¼ ${value || 0} USDT`);
            }
            
            document.getElementById('airdropToken').value = '';
            document.getElementById('airdropAmount').value = '';
            document.getElementById('airdropValue').value = '';
            await saveAllData();
            updateDisplay();
        }

        // æ·»åŠ æˆæœ¬è¨˜éŒ„
        async function addCost() {
            const date = document.getElementById('costDate').value;
            const bnbAmount = parseFloat(document.getElementById('costBnb').value);
            const slippage = parseFloat(document.getElementById('costSlippage').value);
            
            if (!date || (!bnbAmount && !slippage)) {
                alert('ğŸš¨ è«‹å¡«å¯«æ—¥æœŸå’Œè‡³å°‘ä¸€é …æˆæœ¬');
                return;
            }
            
            let usdtValue = 0;
            let rateInfo = { rate: 0, timeInfo: '', diffMinutes: 'N/A' };
            
            if (bnbAmount) {
                if (bnbRateCache[date]) {
                    console.log(`ğŸ—‘ï¸ è‡ªå‹•æ¸…é™¤ ${date} çš„ç·©å­˜åŒ¯ç‡ï¼Œé‡æ–°ç²å–ä¸­...`);
                    delete bnbRateCache[date];
                    delete lastSelectedRateInfo;
                }
                
                document.getElementById('loadingIndicator').classList.remove('hidden');
                rateInfo = await getBnbRate(date);
                usdtValue = bnbAmount * rateInfo.rate;
                document.getElementById('loadingIndicator').classList.add('hidden');
            }
            
            const existingIndex = costs.findIndex(cost => cost.date === date);
            
            if (existingIndex !== -1) {
                const oldBnb = costs[existingIndex].bnbAmount;
                const oldUsdt = costs[existingIndex].usdtValue;
                const oldSlippage = costs[existingIndex].slippage;
                const oldRate = costs[existingIndex].bnbRate;
                
                costs[existingIndex].bnbAmount = bnbAmount || 0;
                costs[existingIndex].usdtValue = usdtValue;
                costs[existingIndex].bnbRate = rateInfo.rate;
                costs[existingIndex].slippage = slippage || 0;
                
                let alertMessage = `ğŸ’¸ å·²æ›´æ–° ${date} çš„è¨˜éŒ„ï¼š\n` +
                    `BNBï¼š${oldBnb} â†’ ${bnbAmount || 0}\n` +
                    `åŒ¯ç‡ï¼š${formatCrypto(oldRate)} â†’ ${formatCrypto(rateInfo.rate)}\n` +
                    `USDTï¼š${formatCrypto(oldUsdt)} â†’ ${formatCrypto(usdtValue)}\n` +
                    `ç£¨æï¼š${formatCrypto(oldSlippage)} â†’ ${formatCrypto(slippage || 0)} USDT`;
                
                if (bnbAmount) {
                    alertMessage += `\n\nğŸ¯ æ™ºèƒ½åŒ¯ç‡é¸æ“‡éç¨‹ï¼š\n`;
                    alertMessage += `â€¢ ç›®æ¨™æ™‚é–“ï¼šå°ç£ 12:30\n`;
                    alertMessage += `â€¢ å¯¦éš›é¸æ“‡ï¼šå°ç£ ${rateInfo.timeInfo}\n`;
                    
                    if (rateInfo.isDefault || rateInfo.isError) {
                        alertMessage += `â€¢ ç‹€æ…‹ï¼š${rateInfo.isError ? 'ç¶²è·¯ç•°å¸¸' : 'APIç„¡è³‡æ–™'}ï¼Œä½¿ç”¨é è¨­åŒ¯ç‡\n`;
                        alertMessage += `â€¢ å‚™è¨»ï¼šå»ºè­°ç¨å¾Œé‡è©¦æˆ–æª¢æŸ¥ç¶²è·¯é€£ç·š`;
                    } else {
                        alertMessage += `â€¢ æ™‚é–“å·®è·ï¼š${rateInfo.diffMinutes === 'N/A' ? 'é™ç´šè™•ç†' : rateInfo.diffMinutes + 'åˆ†é˜'}\n`;
                        alertMessage += `â€¢ ç‹€æ…‹ï¼šâœ… æˆåŠŸé¸æ“‡æœ€æ¥è¿‘ä¸­åˆçš„åŒ¯ç‡`;
                    }
                }
                
                alert(alertMessage);
            } else {
                costs.push({
                    id: Date.now(),
                    date,
                    bnbAmount: bnbAmount || 0,
                    usdtValue,
                    bnbRate: rateInfo.rate,
                    slippage: slippage || 0
                });
                
                let alertMessage = `ğŸ’¸ å·²æ–°å¢ ${date} çš„è¨˜éŒ„ï¼š\n` +
                    `BNBï¼š${bnbAmount || 0}\n` +
                    `åŒ¯ç‡ï¼š${formatCrypto(rateInfo.rate)}\n` +
                    `USDTï¼š${formatCrypto(usdtValue)}\n` +
                    `ç£¨æï¼š${formatCrypto(slippage || 0)} USDT`;
                
                if (bnbAmount) {
                    alertMessage += `\n\nğŸ¯ æ™ºèƒ½åŒ¯ç‡é¸æ“‡éç¨‹ï¼š\n`;
                    alertMessage += `â€¢ ç›®æ¨™æ™‚é–“ï¼šå°ç£ 12:30\n`;
                    alertMessage += `â€¢ å¯¦éš›é¸æ“‡ï¼šå°ç£ ${rateInfo.timeInfo}\n`;
                    
                    if (rateInfo.isDefault || rateInfo.isError) {
                        alertMessage += `â€¢ ç‹€æ…‹ï¼š${rateInfo.isError ? 'ç¶²è·¯ç•°å¸¸' : 'APIç„¡è³‡æ–™'}ï¼Œä½¿ç”¨é è¨­åŒ¯ç‡\n`;
                        alertMessage += `â€¢ å‚™è¨»ï¼šå»ºè­°ç¨å¾Œé‡è©¦æˆ–æª¢æŸ¥ç¶²è·¯é€£ç·š`;
                    } else {
                        alertMessage += `â€¢ æ™‚é–“å·®è·ï¼š${rateInfo.diffMinutes === 'N/A' ? 'é™ç´šè™•ç†' : rateInfo.diffMinutes + 'åˆ†é˜'}\n`;
                        alertMessage += `â€¢ ç‹€æ…‹ï¼šâœ… æˆåŠŸé¸æ“‡æœ€æ¥è¿‘ä¸­åˆçš„åŒ¯ç‡`;
                    }
                }
                
                alert(alertMessage);
            }
            
            document.getElementById('costBnb').value = '';
            document.getElementById('costSlippage').value = '';
            await saveAllData();
            updateDisplay();
        }

        // æ¸…é™¤æ‰€æœ‰æ•¸æ“š
        async function clearAllData() {
            const confirmed = confirm(
                'âš ï¸ ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿ\n\né€™å°‡åˆªé™¤ï¼š\nâ€¢ æ‰€æœ‰æ¯æ—¥åˆ·åˆ†è¨˜éŒ„\nâ€¢ æ‰€æœ‰ç©ºæŠ•è¨˜éŒ„\nâ€¢ æ‰€æœ‰æˆæœ¬è¨˜éŒ„\nâ€¢ BNBåŒ¯ç‡ç·©å­˜\n\næ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ï¼'
            );
            
            if (confirmed) {
                dailyRecords = [];
                airdrops = [];
                costs = [];
                bnbRateCache = {};
                lastSelectedRateInfo = null;
                targetPoints = 150;
                
                dailyCurrentPage = 1;
                airdropCurrentPage = 1;
                costCurrentPage = 1;
                
                localStorage.clear();
                
                document.getElementById('targetPoints').value = 150;
                updateDisplay();
                
                alert('âœ… æ‰€æœ‰æ•¸æ“šå·²æ¸…é™¤ï¼');
            }
        }

        // å…¶é¤˜å‡½æ•¸ä¿æŒä¸è®Š - åˆ†é ã€çµ±è¨ˆã€å ±è¡¨ã€å°å‡ºç­‰
        function changeDailyPage(direction) {
            const totalPages = Math.ceil(dailyRecords.length / itemsPerPage);
            dailyCurrentPage += direction;
            if (dailyCurrentPage < 1) dailyCurrentPage = 1;
            if (dailyCurrentPage > totalPages) dailyCurrentPage = totalPages;
            updateDailyRecordsList();
        }

        function changeAirdropPage(direction) {
            const totalPages = Math.ceil(airdrops.length / itemsPerPage);
            airdropCurrentPage += direction;
            if (airdropCurrentPage < 1) airdropCurrentPage = 1;
            if (airdropCurrentPage > totalPages) airdropCurrentPage = totalPages;
            updateAirdropsList();
        }

        function changeCostPage(direction) {
            const totalPages = Math.ceil(costs.length / itemsPerPage);
            costCurrentPage += direction;
            if (costCurrentPage < 1) costCurrentPage = 1;
            if (costCurrentPage > totalPages) costCurrentPage = totalPages;
            updateCostsList();
        }

        function updateMonthlyStats() {
            const currentMonth = new Date().toISOString().substr(0, 7);
            
            const monthlyPoints = dailyRecords
                .filter(record => record.date.startsWith(currentMonth))
                .reduce((sum, record) => sum + record.points, 0);
            
            const monthlyAirdropValue = airdrops
                .filter(airdrop => airdrop.date.startsWith(currentMonth))
                .reduce((sum, airdrop) => sum + airdrop.usdtValue, 0);
            
            const monthlyCostValue = costs
                .filter(cost => cost.date.startsWith(currentMonth))
                .reduce((sum, cost) => sum + (cost.usdtValue || 0) + (cost.slippage || 0), 0);
            
            const monthlyROI = monthlyCostValue > 0 ? 
                ((monthlyAirdropValue - monthlyCostValue) / monthlyCostValue * 100) : 0;
            
            document.getElementById('monthlyPoints').textContent = monthlyPoints;
            document.getElementById('monthlyAirdrops').textContent = formatCrypto(monthlyAirdropValue);
            document.getElementById('monthlyCosts').textContent = formatCrypto(monthlyCostValue);
            document.getElementById('monthlyROI').textContent = monthlyROI.toFixed(1) + '%';
        }

        function generateReport() {
            generateMonthlyReport();
            generateQuarterlyReport();
            generateSmartSuggestions();
        }

        function generateMonthlyReport() {
            const currentMonth = new Date().toISOString().substr(0, 7);
            const monthlyRecords = dailyRecords.filter(record => record.date.startsWith(currentMonth));
            const monthlyAirdrops = airdrops.filter(airdrop => airdrop.date.startsWith(currentMonth));
            
            const totalPoints = monthlyRecords.reduce((sum, record) => sum + record.points, 0);
            const avgDaily = monthlyRecords.length > 0 ? (totalPoints / monthlyRecords.length).toFixed(1) : 0;
            const airdropCount = monthlyAirdrops.length;
            const airdropValue = monthlyAirdrops.reduce((sum, airdrop) => sum + airdrop.usdtValue, 0);
            
            const report = `
                <p class="text-blue-100">ğŸ“Š åˆ·åˆ†å¤©æ•¸: ${monthlyRecords.length} å¤©</p>
                <p class="text-blue-100">ğŸ¯ ç¸½ç©åˆ†: ${totalPoints} åˆ†</p>
                <p class="text-blue-100">ğŸ“ˆ æ—¥å‡åˆ·åˆ†: ${avgDaily} åˆ†</p>
                <p class="text-blue-100">ğŸ ç©ºæŠ•æ¬¡æ•¸: ${airdropCount} æ¬¡</p>
                <p class="text-blue-100">ğŸ’° ç©ºæŠ•åƒ¹å€¼: ${formatCrypto(airdropValue)} USDT</p>
            `;
            
            document.getElementById('monthlyReport').innerHTML = report;
        }

        function generateQuarterlyReport() {
            const threeMonthsAgo = new Date();
            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
            const cutoffDate = threeMonthsAgo.toISOString().split('T')[0];
            
            const quarterlyRecords = dailyRecords.filter(record => record.date >= cutoffDate);
            const quarterlyAirdrops = airdrops.filter(airdrop => airdrop.date >= cutoffDate);
            const quarterlyCosts = costs.filter(cost => cost.date >= cutoffDate);
            
            const totalPoints = quarterlyRecords.reduce((sum, record) => sum + record.points, 0);
            const totalRevenue = quarterlyAirdrops.reduce((sum, airdrop) => sum + airdrop.usdtValue, 0);
            const totalCosts = quarterlyCosts.reduce((sum, cost) => sum + (cost.usdtValue || 0) + (cost.slippage || 0), 0);
            const netProfit = totalRevenue - totalCosts;
            
            const report = `
                <p class="text-green-100">ğŸ“… çµ±è¨ˆæœŸé–“: è¿‘3å€‹æœˆ</p>
                <p class="text-green-100">ğŸ¯ ç´¯è¨ˆç©åˆ†: ${totalPoints} åˆ†</p>
                <p class="text-green-100">ğŸ’° ç¸½æ”¶ç›Š: ${formatCrypto(totalRevenue)} USDT</p>
                <p class="text-green-100">ğŸ’¸ ç¸½æˆæœ¬: ${formatCrypto(totalCosts)} USDT</p>
                <p class="text-green-100">ğŸ“Š æ·¨åˆ©æ½¤: ${formatCrypto(netProfit)} USDT</p>
            `;
            
            document.getElementById('quarterlyReport').innerHTML = report;
        }

        function generateSmartSuggestions() {
            const stats = calculate15DayStats();
            const suggestions = [];
            
            if (dailyRecords.length >= 3) {
                const userAvgPoints = dailyRecords.reduce((sum, r) => sum + r.points, 0) / dailyRecords.length;
                const totalDays = dailyRecords.length;
                const airdropRate = airdrops.length / totalDays;
                const dailyAirdropPenalty = airdropRate * 15;
                const netDailyGrowth = userAvgPoints - dailyAirdropPenalty;
                
                suggestions.push(`ğŸ“Š å¹³å‡åˆ·åˆ†ï¼š${userAvgPoints.toFixed(1)}åˆ†/å¤©`);
                suggestions.push(`ğŸ¯ 15å¤©æ·¨ç©åˆ†ï¼š${stats.netPoints}/${targetPoints}åˆ†`);
                
                if (stats.remainingPoints > 0) {
                    const daysToTarget = Math.ceil(stats.remainingPoints / netDailyGrowth);
                    if (daysToTarget <= 7) {
                        suggestions.push(`â­ é æ¸¬ç´„${daysToTarget}å¤©é”åˆ°ç›®æ¨™`);
                    } else {
                        suggestions.push(`ğŸ“ˆ å»ºè­°æé«˜æ¯æ—¥åˆ·åˆ†è‡³${(userAvgPoints + 3).toFixed(0)}åˆ†`);
                    }
                } else {
                    suggestions.push(`ğŸ‰ å·²é”æˆç›®æ¨™ï¼è¶…æ¨™${Math.abs(stats.remainingPoints)}åˆ†`);
                }
            } else {
                suggestions.push('ğŸ“Š éœ€æ›´å¤šæ•¸æ“šä¾†ç”Ÿæˆå»ºè­°');
            }
            
            const suggestionHtml = suggestions.map(s => `<p class="text-yellow-100 mb-2">${s}</p>`).join('');
            document.getElementById('smartSuggestions').innerHTML = suggestionHtml;
        }

        // åˆå§‹åŒ–åœ–è¡¨
        function initializeCharts() {
            try {
                initMonthlyRevenueChart();
                initBnbRateChart();
                initDailyPointsChart();
                initCostAnalysisChart();
            } catch (error) {
                console.error('åˆå§‹åŒ–åœ–è¡¨å¤±æ•—:', error);
            }
        }

        // æœˆåº¦æ”¶ç›Šå°æ¯”åœ–
        function initMonthlyRevenueChart() {
            const ctx = document.getElementById('monthlyRevenueChart').getContext('2d');
            
            // éŠ·æ¯€èˆŠåœ–è¡¨
            if (monthlyRevenueChart) {
                monthlyRevenueChart.destroy();
            }
            
            // è¨ˆç®—è¿‘6å€‹æœˆæ•¸æ“š
            const months = [];
            const revenueData = [];
            const costData = [];
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                const monthStr = date.toISOString().substr(0, 7);
                const monthLabel = `${date.getMonth() + 1}æœˆ`;
                
                const monthRevenue = airdrops
                    .filter(a => a.date.startsWith(monthStr))
                    .reduce((sum, a) => sum + a.usdtValue, 0);
                
                const monthCost = costs
                    .filter(c => c.date.startsWith(monthStr))
                    .reduce((sum, c) => sum + (c.usdtValue || 0) + (c.slippage || 0), 0);
                
                months.push(monthLabel);
                revenueData.push(monthRevenue);
                costData.push(monthCost);
            }
            
            monthlyRevenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'ç©ºæŠ•æ”¶ç›Š (USDT)',
                            data: revenueData,
                            backgroundColor: 'rgba(16, 185, 129, 0.8)',
                            borderColor: 'rgba(16, 185, 129, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'ç¸½æˆæœ¬ (USDT)',
                            data: costData,
                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        },
                        x: {
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        }
                    }
                }
            });
        }

        // BNBåŒ¯ç‡è¶¨å‹¢åœ–
        function initBnbRateChart() {
            const ctx = document.getElementById('bnbRateChart').getContext('2d');
            
            if (bnbRateChart) {
                bnbRateChart.destroy();
            }
            
            // æ”¶é›†è¿‘30å¤©æœ‰åŒ¯ç‡æ•¸æ“šçš„æ—¥æœŸ
            const rateData = costs
                .filter(c => c.bnbRate && c.bnbRate > 0)
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(-30)
                .map(c => ({
                    date: c.date,
                    rate: c.bnbRate
                }));
            
            const dates = rateData.map(d => d.date.substr(5)); // MM-DDæ ¼å¼
            const rates = rateData.map(d => d.rate);
            
            bnbRateChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'BNBä¸­åˆåŒ¯ç‡ (USDT)',
                        data: rates,
                        borderColor: 'rgba(251, 191, 36, 1)',
                        backgroundColor: 'rgba(251, 191, 36, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        },
                        x: {
                            ticks: { color: '#9CA3AF', maxTicksLimit: 10 },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        }
                    }
                }
            });
        }

        // æ¯æ—¥åˆ·åˆ†è¶¨å‹¢åœ–
        function initDailyPointsChart() {
            const ctx = document.getElementById('dailyPointsChart').getContext('2d');
            
            if (dailyPointsChart) {
                dailyPointsChart.destroy();
            }
            
            const recentRecords = dailyRecords
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(-30);
            
            const dates = recentRecords.map(r => r.date.substr(5));
            const points = recentRecords.map(r => r.points);
            
            dailyPointsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'æ¯æ—¥åˆ·åˆ†',
                        data: points,
                        borderColor: 'rgba(59, 130, 246, 1)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        },
                        x: {
                            ticks: { color: '#9CA3AF', maxTicksLimit: 10 },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        }
                    }
                }
            });
        }

        // æˆæœ¬çµ„æˆåˆ†æåœ–
        function initCostAnalysisChart() {
            const ctx = document.getElementById('costAnalysisChart').getContext('2d');
            
            if (costAnalysisChart) {
                costAnalysisChart.destroy();
            }
            
            const recentCosts = costs
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(-30);
            
            const dates = recentCosts.map(c => c.date.substr(5));
            const gasFees = recentCosts.map(c => c.usdtValue || 0);
            const slippages = recentCosts.map(c => c.slippage || 0);
            
            costAnalysisChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'Gasè²» (USDT)',
                            data: gasFees,
                            backgroundColor: 'rgba(239, 68, 68, 0.8)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'ç£¨æ (USDT)',
                            data: slippages,
                            backgroundColor: 'rgba(245, 158, 11, 0.8)',
                            borderColor: 'rgba(245, 158, 11, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#fff' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            stacked: true,
                            ticks: { color: '#9CA3AF' },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        },
                        x: {
                            stacked: true,
                            ticks: { color: '#9CA3AF', maxTicksLimit: 10 },
                            grid: { color: 'rgba(156, 163, 175, 0.2)' }
                        }
                    }
                }
            });
        }

        function generateCSV(data, filename) {
            let csv = '';
            
            csv += 'æ—¥æœŸ,é¡å‹,é …ç›®,æ•¸å€¼,USDTåƒ¹å€¼,åŒ¯ç‡,å‚™è¨»\n';
            
            data.daily?.forEach(record => {
                csv += `${record.date},åˆ·åˆ†,æ¯æ—¥ç©åˆ†,${record.points},,,""\n`;
            });
            
            data.airdrops?.forEach(airdrop => {
                csv += `${airdrop.date},ç©ºæŠ•,${airdrop.token},${formatCrypto(airdrop.amount)},${formatCrypto(airdrop.usdtValue)},,"-15åˆ†"\n`;
            });
            
            data.costs?.forEach(cost => {
                if (cost.bnbAmount > 0) {
                    csv += `${cost.date},æˆæœ¬,Gasè²»,${formatCrypto(cost.bnbAmount)},${formatCrypto(cost.usdtValue)},${formatCrypto(cost.bnbRate)},"BNB"\n`;
                }
                if (cost.slippage > 0) {
                    csv += `${cost.date},æˆæœ¬,ç£¨æ,${formatCrypto(cost.slippage)},${formatCrypto(cost.slippage)},,USDT\n`;
                }
            });
            
            const BOM = '\uFEFF';
            const csvWithBOM = BOM + csv;
            
            const blob = new Blob([csvWithBOM], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        function exportAllData() {
            const data = {
                daily: dailyRecords,
                airdrops: airdrops,
                costs: costs
            };
            generateCSV(data, `Alphaç©åˆ†è¿½è¹¤_å…¨éƒ¨æ•¸æ“š_${new Date().toISOString().split('T')[0]}.csv`);
        }

        function exportMonthData() {
            const currentMonth = new Date().toISOString().substr(0, 7);
            
            const data = {
                daily: dailyRecords.filter(r => r.date.startsWith(currentMonth)),
                airdrops: airdrops.filter(r => r.date.startsWith(currentMonth)),
                costs: costs.filter(r => r.date.startsWith(currentMonth))
            };
            generateCSV(data, `Alphaç©åˆ†è¿½è¹¤_${currentMonth}_æœˆåº¦æ•¸æ“š.csv`);
        }

        function exportQuarterData() {
            const threeMonthsAgo = new Date();
            threeMonthsAgo.setMonth(threeMonthsAgo.getMonth() - 3);
            const cutoffDate = threeMonthsAgo.toISOString().split('T')[0];
            
            const data = {
                daily: dailyRecords.filter(r => r.date >= cutoffDate),
                airdrops: airdrops.filter(r => r.date >= cutoffDate),
                costs: costs.filter(r => r.date >= cutoffDate)
            };
            generateCSV(data, `Alphaç©åˆ†è¿½è¹¤_è¿‘3å€‹æœˆ_${new Date().toISOString().split('T')[0]}.csv`);
        }

        function updateDisplay() {
            const stats = calculate15DayStats();
            const totalCosts = calculateTotalCosts();
            
            document.getElementById('netPoints').textContent = stats.netPoints;
            document.getElementById('dateRange').textContent = `ç¯„åœ: ${stats.dateRange}`;
            document.getElementById('remainingPoints').textContent = `é‚„éœ€ ${stats.remainingPoints} åˆ†`;
            document.getElementById('airdropCount').textContent = airdrops.length;
            document.getElementById('airdropDeduction').textContent = `æ‰£ ${airdrops.length * 15} åˆ†`;
            document.getElementById('totalCost').textContent = formatCrypto(totalCosts.gasFee + totalCosts.slippage);
            
            document.getElementById('progressText').textContent = `${stats.netPoints}/${targetPoints} åˆ†`;
            const progressPercent = Math.min((stats.netPoints / targetPoints) * 100, 100);
            document.getElementById('progressBar').style.width = `${progressPercent}%`;
            
            if (stats.remainingPoints > 0) {
                document.getElementById('progressStatus').textContent = `é‚„éœ€è¦ ${stats.remainingPoints} åˆ†é”åˆ°ç›®æ¨™`;
                document.getElementById('progressStatus').className = 'text-gray-400 text-sm mt-3';
            } else {
                document.getElementById('progressStatus').textContent = 'ğŸ‰ æ­å–œé”æˆç›®æ¨™ï¼';
                document.getElementById('progressStatus').className = 'text-neon-green text-sm mt-3 font-bold';
            }
            
            document.getElementById('statsDateRange').textContent = `çµ±è¨ˆç¯„åœ: ${stats.dateRange} (å‰15å¤©ï¼Œä¸å«ä»Šæ—¥)`;
            document.getElementById('statsGrossPoints').textContent = `${stats.grossPoints} åˆ†`;
            document.getElementById('statsAirdropDeducted').textContent = `-${stats.airdropsDeducted} åˆ†`;
            document.getElementById('statsNetPoints').textContent = `${stats.netPoints} åˆ†`;
            document.getElementById('statsTarget').textContent = `${targetPoints} åˆ†`;
            document.getElementById('statsRemaining').textContent = `${stats.remainingPoints} åˆ†`;
            document.getElementById('statsAirdropTotal').textContent = `${airdrops.length} æ¬¡`;
            
            const airdropRevenue = airdrops.reduce((sum, a) => sum + a.usdtValue, 0);
            const totalCostValue = totalCosts.gasFee + totalCosts.slippage;
            const netRevenue = airdropRevenue - totalCostValue;
            
            document.getElementById('statsAirdropRevenue').textContent = `${formatCrypto(airdropRevenue)} USDT`;
            document.getElementById('statsTotalCost').textContent = `${formatCrypto(totalCostValue)} USDT`;
            document.getElementById('statsNetRevenue').textContent = `${formatCrypto(netRevenue)} USDT`;
            
            updateRecordLists();
        }

        function updateRecordLists() {
            updateDailyRecordsList();
            updateAirdropsList();
            updateCostsList();
        }

        function updateDailyRecordsList() {
            const container = document.getElementById('dailyRecords');
            const pagination = document.getElementById('dailyPagination');
            const sorted = dailyRecords.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (sorted.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8 text-lg">ğŸ“ å°šç„¡åˆ·åˆ†è¨˜éŒ„</div>';
                pagination.classList.add('hidden');
                return;
            }
            
            const totalPages = Math.ceil(sorted.length / itemsPerPage);
            const startIndex = (dailyCurrentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, sorted.length);
            const pageItems = sorted.slice(startIndex, endIndex);
            
            container.innerHTML = pageItems.map(record => `
                <div class="record-card p-4 rounded-xl">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-300 font-medium">${record.date}</span>
                        <span class="text-neon-yellow font-bold text-lg">+${record.points} åˆ†</span>
                    </div>
                </div>
            `).join('');
            
            if (totalPages > 1) {
                pagination.classList.remove('hidden');
                document.getElementById('dailyPageInfo').textContent = `ç¬¬ ${dailyCurrentPage} é ï¼Œå…± ${totalPages} é `;
            } else {
                pagination.classList.add('hidden');
            }
        }

        function updateAirdropsList() {
            const container = document.getElementById('airdropRecords');
            const pagination = document.getElementById('airdropPagination');
            const sorted = airdrops.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (sorted.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8 text-lg">ğŸ å°šç„¡ç©ºæŠ•è¨˜éŒ„</div>';
                pagination.classList.add('hidden');
                return;
            }
            
            const totalPages = Math.ceil(sorted.length / itemsPerPage);
            const startIndex = (airdropCurrentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, sorted.length);
            const pageItems = sorted.slice(startIndex, endIndex);
            
            container.innerHTML = pageItems.map(airdrop => `
                <div class="record-card p-4 rounded-xl">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="flex items-center gap-3 mb-1">
                                <span class="text-neon-green font-bold text-lg">${airdrop.token}</span>
                                <span class="text-gray-400">x${formatCrypto(airdrop.amount)}</span>
                            </div>
                            <span class="text-gray-500 text-sm">${airdrop.date}</span>
                        </div>
                        <div class="text-right">
                            <div class="text-neon-green font-bold text-lg">${formatCrypto(airdrop.usdtValue)} USDT</div>
                            <div class="text-neon-red text-sm">-15åˆ†</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            if (totalPages > 1) {
                pagination.classList.remove('hidden');
                document.getElementById('airdropPageInfo').textContent = `ç¬¬ ${airdropCurrentPage} é ï¼Œå…± ${totalPages} é `;
            } else {
                pagination.classList.add('hidden');
            }
        }

        function updateCostsList() {
            const container = document.getElementById('costRecords');
            const pagination = document.getElementById('costPagination');
            const sorted = costs.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            if (sorted.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-500 py-8 text-lg">ğŸ’¸ å°šç„¡æˆæœ¬è¨˜éŒ„</div>';
                pagination.classList.add('hidden');
                return;
            }
            
            const totalPages = Math.ceil(sorted.length / itemsPerPage);
            const startIndex = (costCurrentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, sorted.length);
            const pageItems = sorted.slice(startIndex, endIndex);
            
            container.innerHTML = pageItems.map(cost => `
                <div class="record-card p-4 rounded-xl">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-300 font-medium">${cost.date}</span>
                        <div class="text-right">
                            ${cost.bnbAmount > 0 ? `
                                <div class="text-neon-red font-medium">
                                    ${formatCrypto(cost.bnbAmount)} BNB â†’ ${formatCrypto(cost.usdtValue)} USDT
                                    <div class="text-xs text-gray-400">@ ${formatCrypto(cost.bnbRate)} USDT/BNB</div>
                                </div>
                            ` : ''}
                            ${cost.slippage > 0 ? `<div class="text-orange-400 font-medium mt-1">ç£¨æ: ${formatCrypto(cost.slippage)} USDT</div>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            
            if (totalPages > 1) {
                pagination.classList.remove('hidden');
                document.getElementById('costPageInfo').textContent = `ç¬¬ ${costCurrentPage} é ï¼Œå…± ${totalPages} é `;
            } else {
                pagination.classList.add('hidden');
            }
        }

        console.log('ğŸš€ Alphaç©åˆ†è¿½è¹¤å™¨ Firebaseæœ€å°åŒ–ä¿®æ­£ç‰ˆå·²å•Ÿå‹•ï¼');
    </script>
</body>
</html>
